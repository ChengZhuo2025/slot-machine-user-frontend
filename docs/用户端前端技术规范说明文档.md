# çˆ±ä¸Šæœç¾äºº - ç”¨æˆ·ç«¯å‰ç«¯æŠ€æœ¯è§„èŒƒè¯´æ˜æ–‡æ¡£

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 æŠ€æœ¯æ¶æ„

æœ¬é¡¹ç›®é‡‡ç”¨ UniApp 3.0 + Vue 3 æŠ€æœ¯æ ˆå¼€å‘å¤šç«¯åº”ç”¨ï¼Œæ”¯æŒ H5ã€å¾®ä¿¡å°ç¨‹åºã€App ç­‰å¤šä¸ªå¹³å°ã€‚ä¸ºäº†åœ¨åç«¯ API å¼€å‘å®Œæˆå‰èƒ½å¤Ÿå……åˆ†å±•ç¤ºå‰ç«¯åŠŸèƒ½å’Œç”¨æˆ·äº¤äº’ä½“éªŒï¼Œé¡¹ç›®é›†æˆäº† Mock æœåŠ¡æ¥æ¨¡æ‹ŸçœŸå®çš„æ•°æ®äº¤äº’ã€‚

- **æ¡†æ¶**: UniApp 3.0 + Vue 3.x
- **çŠ¶æ€ç®¡ç†**: Pinia
- **æ ·å¼**: SCSS + è‡ªå®šä¹‰æ ·å¼ç³»ç»Ÿ
- **å›¾æ ‡**: Iconify + MynaUI
- **åŠ¨ç”»**: Animate.css
- **Mock**: MockJS
- **æµ‹è¯•**: Vitest + Vue Test Utils
- **æ„å»º**: Vite
- **ä»£ç è§„èŒƒ**: ESLint + Prettier
- **å¾®ä¿¡é›†æˆ**: å¾®ä¿¡ JS-SDK + å°ç¨‹åº API
- **ç¬¬ä¸‰æ–¹æœåŠ¡**: é˜¿é‡Œäº‘ OSS
- **ç¼“å­˜**: Redis + æœ¬åœ°ç¼“å­˜

### 1.2 é¡¹ç›®ç›®æ ‡

- æ„å»ºé«˜æ€§èƒ½çš„ H5 å’Œå°ç¨‹åºåº”ç”¨ï¼Œä¸»è¦è¿è¡Œåœ¨å¾®ä¿¡ç¯å¢ƒä¸‹
- æä¾›ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒå’Œäº¤äº’è®¾è®¡ï¼Œé€‚é…å¾®ä¿¡æµè§ˆå™¨å’Œå°ç¨‹åº
- å»ºç«‹å®Œå–„çš„å¼€å‘è§„èŒƒå’Œä»£ç è´¨é‡æ ‡å‡†
- é€šè¿‡ Mock æ•°æ®å®ç°å®Œæ•´çš„å‰ç«¯åŠŸèƒ½æ¼”ç¤º
- é›†æˆå¾®ä¿¡ç”Ÿæ€ç›¸å…³åŠŸèƒ½ï¼Œå¦‚å¾®ä¿¡æˆæƒã€åˆ†äº«ç­‰

### 1.3 æŠ€æœ¯é€‰å‹ç†ç”±

**UniApp 3.0 ä¼˜åŠ¿ï¼š**

- ä¸€å¥—ä»£ç å¤šç«¯è¿è¡Œï¼Œå¼€å‘æ•ˆç‡é«˜
- åŸç”Ÿæ¸²æŸ“æ€§èƒ½ï¼Œæ¥è¿‘åŸç”Ÿ App ä½“éªŒ
- ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€å’Œç¤¾åŒºæ”¯æŒ
- å®Œå–„çš„è°ƒè¯•å·¥å…·å’Œå¼€å‘ç¯å¢ƒ

**Vue 3 ä¼˜åŠ¿ï¼š**

- Composition API æä¾›æ›´å¥½çš„é€»è¾‘å¤ç”¨
- æ›´å¥½çš„ TypeScript æ”¯æŒ
- æ€§èƒ½æå‡å’ŒåŒ…ä½“ç§¯ä¼˜åŒ–
- æ´»è·ƒçš„ç¤¾åŒºå’Œç”Ÿæ€

## äºŒã€å¼€å‘ç¯å¢ƒé…ç½®

### 2.1 ç¯å¢ƒè¦æ±‚

```bash
# Node.jsç‰ˆæœ¬è¦æ±‚
Node.js >= 16.17.0

# åŒ…ç®¡ç†å™¨
npm >= 8.15.0 æˆ– yarn >= 1.22.0 æˆ– pnpm >= 7.0.0

# å¼€å‘å·¥å…·
HBuilderX >= 3.8.0 æˆ– CLIæ–¹å¼å¼€å‘
```

### 2.2 é¡¹ç›®åˆå§‹åŒ–

```bash
# åˆ›å»ºUniAppé¡¹ç›®ï¼ˆå¦‚æœä½¿ç”¨CLIï¼‰
npx @dcloudio/uvm@latest

# è¿›å…¥é¡¹ç›®ç›®å½•
cd user-frontend

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev:h5
```

### 2.3 å¼€å‘å·¥å…·é…ç½®

**HBuilderX é…ç½®ï¼š**

```json
{
  "editor.fontSize": 14,
  "editor.tabSize": 2,
  "editor.insertSpaces": true,
  "editor.detectIndentation": false,
  "files.eol": "\n",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  }
}
```

### 2.4 å¾®ä¿¡ç¯å¢ƒé…ç½®

**å¾®ä¿¡å°ç¨‹åºé…ç½®ï¼ˆproject.config.jsonï¼‰ï¼š**

```json
{
  "description": "çˆ±ä¸Šæœç¾äººå°ç¨‹åº",
  "packOptions": {
    "ignore": []
  },
  "setting": {
    "urlCheck": false,
    "scopeDataCheck": false,
    "coverView": true,
    "es6": true,
    "enhance": true,
    "showShadowRootInWxmlPanel": true,
    "packNpmManually": false,
    "packNpmRelationList": [],
    "minifyWXSS": true
  },
  "compileType": "miniprogram",
  "libVersion": "2.19.4",
  "appid": "your_appid_here",
  "projectname": "love-dumeinv-miniprogram",
  "debugOptions": {
    "hidedInDevtools": []
  },
  "scripts": {},
  "isGameTourist": false,
  "simulatorType": "wechat",
  "simulatorPluginLibVersion": {},
  "condition": {
    "plugin": {
      "list": []
    },
    "game": {
      "list": []
    },
    "gamePlugin": {
      "list": []
    },
    "miniprogram": {
      "list": []
    }
  }
}
```

**H5 å¾®ä¿¡ç¯å¢ƒé€‚é…ï¼š**

```javascript
// utils/weixin.js
export const isWeixin = () => {
  return /MicroMessenger/i.test(navigator.userAgent);
};

export const getWeixinVersion = () => {
  const ua = navigator.userAgent.toLowerCase();
  const match = ua.match(/micromessenger\/(\d+\.\d+\.\d+)/);
  return match ? match[1] : null;
};

// å¾®ä¿¡ç¯å¢ƒä¸‹çš„ç‰¹æ®Šå¤„ç†
export const initWeixinEnv = () => {
  if (isWeixin()) {
    // éšè—å¾®ä¿¡æµè§ˆå™¨çš„åˆ†äº«æŒ‰é’®ç­‰
    document.addEventListener("WeixinJSBridgeReady", () => {
      // å¾®ä¿¡ç¯å¢ƒåˆå§‹åŒ–å®Œæˆ
    });
  }
};
```

**VSCode é…ç½®ï¼ˆå¦‚ä½¿ç”¨ CLI å¼€å‘ï¼‰ï¼š**

```json
{
  "editor.fontSize": 14,
  "editor.tabSize": 2,
  "editor.insertSpaces": true,
  "editor.detectIndentation": false,
  "files.eol": "\n",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "vetur.experimental.templateInterpolationService": true
}
```

## ä¸‰ã€é¡¹ç›®ç»“æ„è®¾è®¡

### 3.1 ç›®å½•ç»“æ„

```
user-frontend/
â”œâ”€â”€ src/                          # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ components/               # å…¬å…±ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ common/              # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ business/            # ä¸šåŠ¡ç»„ä»¶
â”‚   â”‚   â””â”€â”€ layout/              # å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ pages/                   # é¡µé¢æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ index/               # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ hotel/               # é…’åº—ç›¸å…³é¡µé¢
â”‚   â”‚   â”œâ”€â”€ mall/                # å•†åŸç›¸å…³é¡µé¢
â”‚   â”‚   â”œâ”€â”€ distribution/        # åˆ†é”€ç›¸å…³é¡µé¢
â”‚   â”‚   â”œâ”€â”€ user/                # ç”¨æˆ·ä¸­å¿ƒé¡µé¢
â”‚   â”‚   â””â”€â”€ scan/                # æ‰«ç é¡µé¢
â”‚   â”œâ”€â”€ static/                  # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ images/              # å›¾ç‰‡èµ„æº
â”‚   â”‚   â”œâ”€â”€ icons/               # å›¾æ ‡èµ„æº
â”‚   â”‚   â””â”€â”€ fonts/               # å­—ä½“èµ„æº
â”‚   â”œâ”€â”€ styles/                  # æ ·å¼æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ index.scss           # å…¨å±€æ ·å¼å…¥å£
â”‚   â”‚   â”œâ”€â”€ variables.scss       # æ ·å¼å˜é‡
â”‚   â”‚   â”œâ”€â”€ mixins.scss          # æ ·å¼æ··åˆ
â”‚   â”‚   â””â”€â”€ normalize.scss       # æ ·å¼é‡ç½®
â”‚   â”œâ”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ request.js           # ç½‘ç»œè¯·æ±‚å°è£…
â”‚   â”‚   â”œâ”€â”€ storage.js           # æœ¬åœ°å­˜å‚¨å°è£…
â”‚   â”‚   â”œâ”€â”€ auth.js              # æƒé™è®¤è¯
â”‚   â”‚   â”œâ”€â”€ validate.js          # è¡¨å•éªŒè¯
â”‚   â”‚   â””â”€â”€ common.js            # é€šç”¨å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ stores/                  # çŠ¶æ€ç®¡ç†ï¼ˆPiniaï¼‰
â”‚   â”‚   â”œâ”€â”€ index.js             # Storeå…¥å£
â”‚   â”‚   â”œâ”€â”€ user.js              # ç”¨æˆ·çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ hotel.js             # é…’åº—çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ cart.js              # è´­ç‰©è½¦çŠ¶æ€
â”‚   â”‚   â””â”€â”€ app.js               # åº”ç”¨çŠ¶æ€
â”‚   â”œâ”€â”€ services/                # APIæœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ index.js             # æœåŠ¡å…¥å£
â”‚   â”‚   â”œâ”€â”€ user.js              # ç”¨æˆ·ç›¸å…³API
â”‚   â”‚   â”œâ”€â”€ hotel.js             # é…’åº—ç›¸å…³API
â”‚   â”‚   â”œâ”€â”€ mall.js              # å•†åŸç›¸å…³API
â”‚   â”‚   â””â”€â”€ distribution.js      # åˆ†é”€ç›¸å…³API
â”‚   â”œâ”€â”€ mock/                    # Mockæ•°æ®æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ index.js             # MockæœåŠ¡å…¥å£
â”‚   â”‚   â”œâ”€â”€ user.js              # ç”¨æˆ·Mockæ•°æ®
â”‚   â”‚   â”œâ”€â”€ hotel.js             # é…’åº—Mockæ•°æ®
â”‚   â”‚   â”œâ”€â”€ mall.js              # å•†åŸMockæ•°æ®
â”‚   â”‚   â””â”€â”€ distribution.js      # åˆ†é”€Mockæ•°æ®
â”‚   â”œâ”€â”€ composables/             # ç»„åˆå¼å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ useAuth.js           # è®¤è¯ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ useHotel.js          # é…’åº—ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ useCart.js           # è´­ç‰©è½¦ç›¸å…³
â”‚   â”‚   â””â”€â”€ useLoading.js        # åŠ è½½çŠ¶æ€
â”‚   â”œâ”€â”€ uni_modules/             # uniæ’ä»¶
â”‚   â”œâ”€â”€ App.vue                  # åº”ç”¨å…¥å£ç»„ä»¶
â”‚   â”œâ”€â”€ main.js                  # åº”ç”¨å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ manifest.json            # åº”ç”¨é…ç½®æ–‡ä»¶
â”œâ”€â”€ public/                      # å…¬å…±èµ„æº
â”œâ”€â”€ .env.development            # å¼€å‘ç¯å¢ƒå˜é‡
â”œâ”€â”€ .env.production             # ç”Ÿäº§ç¯å¢ƒå˜é‡
â”œâ”€â”€ .eslintrc.js                # ESLinté…ç½®
â”œâ”€â”€ .gitignore                  # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ package.json                # é¡¹ç›®é…ç½®
â”œâ”€â”€ pnpm-lock.yaml             # ä¾èµ–é”å®šæ–‡ä»¶
â”œâ”€â”€ README.md                   # é¡¹ç›®è¯´æ˜
â””â”€â”€ vite.config.js             # Viteé…ç½®
```

### 3.2 é¡µé¢è·¯ç”±è®¾è®¡

```json
{
  "pages": [
    {
      "path": "pages/index/index",
      "style": {
        "navigationBarTitleText": "çˆ±ä¸Šæœç¾äºº",
        "enablePullDownRefresh": true
      }
    },
    {
      "path": "pages/hotel/list",
      "style": {
        "navigationBarTitleText": "é…’åº—åˆ—è¡¨"
      }
    },
    {
      "path": "pages/hotel/detail",
      "style": {
        "navigationBarTitleText": "é…’åº—è¯¦æƒ…"
      }
    },
    {
      "path": "pages/hotel/room-detail",
      "style": {
        "navigationBarTitleText": "æˆ¿é—´è¯¦æƒ…"
      }
    },
    {
      "path": "pages/mall/index",
      "style": {
        "navigationBarTitleText": "å•†åŸ"
      }
    },
    {
      "path": "pages/mall/product-detail",
      "style": {
        "navigationBarTitleText": "å•†å“è¯¦æƒ…"
      }
    },
    {
      "path": "pages/scan/index",
      "style": {
        "navigationBarTitleText": "æ‰«ä¸€æ‰«"
      }
    },
    {
      "path": "pages/distribution/index",
      "style": {
        "navigationBarTitleText": "èµšé’±"
      }
    },
    {
      "path": "pages/user/index",
      "style": {
        "navigationBarTitleText": "æˆ‘çš„"
      }
    }
  ]
}
```

## å››ã€æ ¸å¿ƒæŠ€æœ¯å®ç°

### 4.1 çŠ¶æ€ç®¡ç†ï¼ˆPiniaï¼‰

**å®‰è£… Piniaï¼š**

```bash
npm install pinia
```

**stores/index.jsï¼š**

```javascript
import { createPinia } from "pinia";

const pinia = createPinia();

export default pinia;

// æŒä¹…åŒ–æ’ä»¶ï¼ˆå¯é€‰ï¼‰
import { createPersistedState } from "pinia-plugin-persistedstate";
pinia.use(
  createPersistedState({
    storage: {
      getItem: uni.getStorageSync,
      setItem: uni.setStorageSync,
    },
  })
);
```

**stores/user.jsï¼š**

```javascript
import { defineStore } from "pinia";
import { ref, computed } from "vue";

export const useUserStore = defineStore(
  "user",
  () => {
    // çŠ¶æ€
    const token = ref("");
    const userInfo = ref({});
    const isLogin = computed(() => !!token.value);

    // æ“ä½œ
    const login = async (loginData) => {
      try {
        // è°ƒç”¨ç™»å½•API
        const response = await userApi.login(loginData);
        token.value = response.token;
        userInfo.value = response.user;
        return response;
      } catch (error) {
        console.error("ç™»å½•å¤±è´¥:", error);
        throw error;
      }
    };

    const logout = () => {
      token.value = "";
      userInfo.value = {};
      uni.removeStorageSync("token");
    };

    return {
      token,
      userInfo,
      isLogin,
      login,
      logout,
    };
  },
  {
    persist: {
      paths: ["token", "userInfo"],
    },
  }
);
```

### 4.2 ç½‘ç»œè¯·æ±‚å°è£…

**utils/request.jsï¼š**

```javascript
import { useUserStore } from "@/stores/user";

// è¯·æ±‚é…ç½®
const config = {
  baseURL:
    process.env.NODE_ENV === "development"
      ? "http://localhost:3000/api"
      : "https://api.example.com",
  timeout: 10000,
  header: {
    "Content-Type": "application/json",
  },
};

// è¯·æ±‚æ‹¦æˆªå™¨
const requestInterceptor = (options) => {
  const userStore = useUserStore();

  // æ·»åŠ è®¤è¯token
  if (userStore.token) {
    options.header.Authorization = `Bearer ${userStore.token}`;
  }

  // æ·»åŠ å…¬å…±å‚æ•°
  options.url = config.baseURL + options.url;
  options.timeout = config.timeout;

  // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
  uni.showLoading({
    title: "åŠ è½½ä¸­...",
    mask: true,
  });

  return options;
};

// å“åº”æ‹¦æˆªå™¨
const responseInterceptor = (response) => {
  uni.hideLoading();

  const { statusCode, data } = response;

  if (statusCode === 200) {
    if (data.code === 200) {
      return data.data;
    } else {
      // ä¸šåŠ¡é”™è¯¯å¤„ç†
      uni.showToast({
        title: data.message || "è¯·æ±‚å¤±è´¥",
        icon: "none",
      });
      return Promise.reject(data);
    }
  } else if (statusCode === 401) {
    // æœªæˆæƒï¼Œè·³è½¬ç™»å½•
    const userStore = useUserStore();
    userStore.logout();
    uni.navigateTo({
      url: "/pages/user/login",
    });
    return Promise.reject(response);
  } else {
    // å…¶ä»–é”™è¯¯
    uni.showToast({
      title: "ç½‘ç»œé”™è¯¯",
      icon: "none",
    });
    return Promise.reject(response);
  }
};

// å°è£…è¯·æ±‚æ–¹æ³•
const request = {
  get(url, data = {}) {
    return new Promise((resolve, reject) => {
      const options = requestInterceptor({
        url,
        method: "GET",
        data,
        header: { ...config.header },
      });

      uni.request({
        ...options,
        success: (res) => {
          responseInterceptor(res).then(resolve).catch(reject);
        },
        fail: reject,
      });
    });
  },

  post(url, data = {}) {
    return new Promise((resolve, reject) => {
      const options = requestInterceptor({
        url,
        method: "POST",
        data,
        header: { ...config.header },
      });

      uni.request({
        ...options,
        success: (res) => {
          responseInterceptor(res).then(resolve).catch(reject);
        },
        fail: reject,
      });
    });
  },

  put(url, data = {}) {
    return new Promise((resolve, reject) => {
      const options = requestInterceptor({
        url,
        method: "PUT",
        data,
        header: { ...config.header },
      });

      uni.request({
        ...options,
        success: (res) => {
          responseInterceptor(res).then(resolve).catch(reject);
        },
        fail: reject,
      });
    });
  },

  delete(url, data = {}) {
    return new Promise((resolve, reject) => {
      const options = requestInterceptor({
        url,
        method: "DELETE",
        data,
        header: { ...config.header },
      });

      uni.request({
        ...options,
        success: (res) => {
          responseInterceptor(res).then(resolve).catch(reject);
        },
        fail: reject,
      });
    });
  },
};

export default request;
```

### 4.3 Mock æ•°æ®æœåŠ¡

**å®‰è£… Mock ç›¸å…³ä¾èµ–ï¼š**

```bash
npm install mockjs @types/mockjs --save-dev
```

**mock/index.jsï¼š**

```javascript
import Mock from "mockjs";
import userMock from "./user";
import hotelMock from "./hotel";
import mallMock from "./mall";
import distributionMock from "./distribution";

// é…ç½®Mock
Mock.setup({
  timeout: "200-1000", // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
});

// æ˜¯å¦å¯ç”¨Mock
const isMockEnabled =
  process.env.NODE_ENV === "development" && process.env.VUE_APP_MOCK === "true";

if (isMockEnabled) {
  console.log("ğŸš€ MockæœåŠ¡å·²å¯åŠ¨");

  // æ³¨å†ŒMockæ¥å£
  userMock();
  hotelMock();
  mallMock();
  distributionMock();
}

export default Mock;
```

**mock/user.jsï¼š**

```javascript
import Mock from "mockjs";

const Random = Mock.Random;

export default function userMock() {
  // ç”¨æˆ·ç™»å½•
  Mock.mock(/\/api\/user\/login/, "post", () => {
    return {
      code: 200,
      message: "ç™»å½•æˆåŠŸ",
      data: {
        token: Random.string("lower", 32),
        user: {
          id: Random.id(),
          avatar: Random.image("100x100"),
          nickname: Random.cname(),
          phone: /^1[3-9]\d{9}$/,
          gender: Random.integer(0, 2),
          birthday: Random.date("yyyy-MM-dd"),
          memberLevel: Random.integer(1, 5),
          balance: Random.float(0, 1000, 2, 2),
          points: Random.integer(0, 10000),
        },
      },
    };
  });

  // è·å–ç”¨æˆ·ä¿¡æ¯
  Mock.mock(/\/api\/user\/info/, "get", () => {
    return {
      code: 200,
      message: "è·å–æˆåŠŸ",
      data: {
        id: Random.id(),
        avatar: Random.image("100x100"),
        nickname: Random.cname(),
        phone: /^1[3-9]\d{9}$/,
        gender: Random.integer(0, 2),
        birthday: Random.date("yyyy-MM-dd"),
        memberLevel: Random.integer(1, 5),
        balance: Random.float(0, 1000, 2, 2),
        points: Random.integer(0, 10000),
        memberCard: {
          level: Random.integer(1, 5),
          levelName: Random.pick([
            "æ™®é€šä¼šå‘˜",
            "VIPä¼šå‘˜",
            "é‡‘å¡ä¼šå‘˜",
            "é’»çŸ³ä¼šå‘˜",
            "è‡³å°Šä¼šå‘˜",
          ]),
          expireTime: Random.date("yyyy-MM-dd"),
          discount: Random.float(0.7, 0.9, 1, 1),
        },
      },
    };
  });

  // è·å–ç”¨æˆ·è®¢å•åˆ—è¡¨
  Mock.mock(/\/api\/user\/orders/, "get", () => {
    return {
      code: 200,
      message: "è·å–æˆåŠŸ",
      data: {
        "list|10": [
          {
            id: "@id",
            orderNo: /^[A-Z0-9]{16}$/,
            type: "@pick([1, 2])", // 1-é…’åº—è®¢å• 2-å•†å“è®¢å•
            title: "@ctitle(5, 20)",
            image: "@image(200x150)",
            amount: "@float(50, 500, 2, 2)",
            status: "@integer(1, 5)", // 1-å¾…æ”¯ä»˜ 2-å¾…ä½¿ç”¨ 3-å·²å®Œæˆ 4-å·²å–æ¶ˆ 5-å·²é€€æ¬¾
            createTime: '@datetime("yyyy-MM-dd HH:mm:ss")',
            useTime: '@datetime("yyyy-MM-dd HH:mm:ss")',
          },
        ],
        total: 50,
        page: 1,
        pageSize: 10,
      },
    };
  });
}
```

**mock/hotel.jsï¼š**

```javascript
import Mock from "mockjs";

const Random = Mock.Random;

export default function hotelMock() {
  // è·å–é…’åº—åˆ—è¡¨
  Mock.mock(/\/api\/hotel\/list/, "get", () => {
    return {
      code: 200,
      message: "è·å–æˆåŠŸ",
      data: {
        "list|20": [
          {
            id: "@id",
            name: "@ctitle(8, 15)",
            type: "@pick([1, 2, 3, 4])", // 1-ç”µç«é…’åº— 2-ä¸»é¢˜é…’åº— 3-ç§äº«é…’åº— 4-å°Šä½é…’åº—
            typeName: '@pick(["ç”µç«é…’åº—", "ä¸»é¢˜é…’åº—", "ç§äº«é…’åº—", "å°Šä½é…’åº—"])',
            image: "@image(300x200)",
            "images|3-8": ["@image(300x200)"],
            address: "@county(true)",
            distance: "@float(0.1, 50, 1, 1)",
            priceRange: {
              min: "@integer(99, 199)",
              max: "@integer(299, 599)",
            },
            remainingRooms: "@integer(0, 20)",
            rating: "@float(3.5, 5.0, 1, 1)",
            "reviewCount|100-1000": 1,
            phone: /^1[3-9]\d{9}$/,
            businessHours: "24å°æ—¶è¥ä¸š",
            "facilities|5-10": [
              '@pick(["WiFi", "åœè½¦åœº", "ç”µæ¢¯", "24å°æ—¶å‰å°", "æ´—è¡£æœåŠ¡", "å¥èº«æˆ¿", "æ¸¸æ³³æ± ", "é¤å…", "ä¼šè®®å®¤", "å•†åŠ¡ä¸­å¿ƒ"])',
            ],
            latitude: "@float(22.5, 22.6, 6, 6)",
            longitude: "@float(113.9, 114.0, 6, 6)",
          },
        ],
        total: 100,
        page: 1,
        pageSize: 20,
      },
    };
  });

  // è·å–é…’åº—è¯¦æƒ…
  Mock.mock(/\/api\/hotel\/detail\/\d+/, "get", () => {
    return {
      code: 200,
      message: "è·å–æˆåŠŸ",
      data: {
        id: "@id",
        name: "@ctitle(8, 15)",
        type: "@pick([1, 2, 3, 4])",
        typeName: '@pick(["ç”µç«é…’åº—", "ä¸»é¢˜é…’åº—", "ç§äº«é…’åº—", "å°Šä½é…’åº—"])',
        "images|5-10": ["@image(400x300)"],
        address: "@county(true)",
        distance: "@float(0.1, 50, 1, 1)",
        phone: /^1[3-9]\d{9}$/,
        businessHours: "24å°æ—¶è¥ä¸š",
        description: "@cparagraph(3, 5)",
        "facilities|8-15": [
          '@pick(["WiFi", "åœè½¦åœº", "ç”µæ¢¯", "24å°æ—¶å‰å°", "æ´—è¡£æœåŠ¡", "å¥èº«æˆ¿", "æ¸¸æ³³æ± ", "é¤å…", "ä¼šè®®å®¤", "å•†åŠ¡ä¸­å¿ƒ", "SPA", "æ¡‘æ‹¿", "KTV", "æ¸¸æˆå®¤", "å„¿ç«¥ä¹å›­"])',
        ],
        rating: "@float(3.5, 5.0, 1, 1)",
        "reviewCount|100-1000": 1,
        latitude: "@float(22.5, 22.6, 6, 6)",
        longitude: "@float(113.9, 114.0, 6, 6)",
        "rooms|5-15": [
          {
            id: "@id",
            name: "@ctitle(5, 12)",
            type: '@pick(["æ ‡å‡†é—´", "å¤§åºŠæˆ¿", "åŒåºŠæˆ¿", "å¥—æˆ¿", "ä¸»é¢˜æˆ¿"])',
            "images|3-6": ["@image(400x300)"],
            area: "@integer(20, 80)",
            bedType: '@pick(["å•äººåºŠ", "åŒäººåºŠ", "å¤§åºŠ", "ä¸Šä¸‹é“º"])',
            maxGuests: "@integer(1, 4)",
            "facilities|5-10": [
              '@pick(["ç‹¬ç«‹å«æµ´", "ç©ºè°ƒ", "ç”µè§†", "å†°ç®±", "å¹é£æœº", "æ‹–é‹", "æ´—æµ´ç”¨å“", "çŸ¿æ³‰æ°´", "èŒ¶å…·", "ä¿é™©ç®±", "ç†¨æ–—", "ç”µè¯"])',
            ],
            price: {
              weekday: "@integer(199, 399)",
              weekend: "@integer(299, 599)",
              holiday: "@integer(399, 799)",
            },
            memberPrice: {
              weekday: "@integer(159, 319)",
              weekend: "@integer(239, 479)",
              holiday: "@integer(319, 639)",
            },
            remainingCount: "@integer(0, 10)",
            "availableTimeSlots|3-8": [
              {
                start: '@time("HH:mm")',
                end: '@time("HH:mm")',
                duration: "@pick([60, 90, 120, 180])", // åˆ†é’Ÿ
                available: "@boolean",
              },
            ],
          },
        ],
        "reviews|10": [
          {
            id: "@id",
            user: {
              nickname: "@cname",
              avatar: "@image(50x50)",
            },
            rating: "@float(3.0, 5.0, 1, 1)",
            content: "@cparagraph(1, 3)",
            "images|0-6": ["@image(150x150)"],
            createTime: '@datetime("yyyy-MM-dd HH:mm:ss")',
            "tags|0-3": [
              '@pick(["ç¯å¢ƒå¥½", "æœåŠ¡ä½³", "æ€§ä»·æ¯”é«˜", "ä½ç½®ä¾¿åˆ©", "è®¾æ–½é½å…¨", "å¹²å‡€æ•´æ´"])',
            ],
          },
        ],
      },
    };
  });

  // è·å–çƒ­é—¨æˆ¿å‹æ¨è
  Mock.mock(/\/api\/hotel\/hot-rooms/, "get", () => {
    return {
      code: 200,
      message: "è·å–æˆåŠŸ",
      data: {
        "list|6": [
          {
            id: "@id",
            hotelId: "@id",
            hotelName: "@ctitle(8, 15)",
            roomName: "@ctitle(5, 12)",
            image: "@image(300x200)",
            description: "@ctitle(10, 30)",
            price: "@integer(199, 599)",
            memberPrice: "@integer(159, 479)",
            remainingCount: "@integer(1, 15)",
            nextAvailableTime: '@time("HH:mm")',
            "tags|2-4": ['@pick(["çƒ­é—¨", "ç‰¹æƒ ", "æ–°å“", "é™æ—¶"])'],
          },
        ],
      },
    };
  });
}
```

**mock/mall.jsï¼š**

```javascript
import Mock from "mockjs";

const Random = Mock.Random;

export default function mallMock() {
  // è·å–å•†å“åˆ†ç±»
  Mock.mock(/\/api\/mall\/categories/, "get", () => {
    return {
      code: 200,
      message: "è·å–æˆåŠŸ",
      data: [
        { id: 1, name: "é…’åº—ç”¨å“", icon: "@image(60x60)", sort: 1 },
        { id: 2, name: "ä¸ªæŠ¤ç”¨å“", icon: "@image(60x60)", sort: 2 },
        { id: 3, name: "æƒ…è¶£ç”¨å“", icon: "@image(60x60)", sort: 3 },
        { id: 4, name: "å…¶ä»–å•†å“", icon: "@image(60x60)", sort: 4 },
      ],
    };
  });

  // è·å–å•†å“åˆ—è¡¨
  Mock.mock(/\/api\/mall\/products/, "get", () => {
    return {
      code: 200,
      message: "è·å–æˆåŠŸ",
      data: {
        "list|20": [
          {
            id: "@id",
            name: "@ctitle(5, 20)",
            subtitle: "@ctitle(10, 30)",
            "images|3-8": ["@image(400x400)"],
            categoryId: "@pick([1, 2, 3, 4])",
            price: "@float(19.9, 199.9, 1, 1)",
            memberPrice: "@float(15.9, 159.9, 1, 1)",
            originalPrice: "@float(29.9, 299.9, 1, 1)",
            stock: "@integer(0, 1000)",
            sales: "@integer(0, 9999)",
            rating: "@float(4.0, 5.0, 1, 1)",
            "reviewCount|10-999": 1,
            "tags|0-3": [
              '@pick(["çƒ­é”€", "æ–°å“", "ç‰¹æƒ ", "é™æ—¶", "åŒ…é‚®", "æ­£å“"])',
            ],
            "specs|2-4": [
              {
                name: '@pick(["é¢œè‰²", "å°ºå¯¸", "è§„æ ¼", "å‹å·"])',
                "options|2-6": [
                  '@pick(["çº¢è‰²", "è“è‰²", "é»‘è‰²", "ç™½è‰²", "S", "M", "L", "XL", "æ ‡å‡†ç‰ˆ", "è±ªåç‰ˆ"])',
                ],
              },
            ],
            description: "@cparagraph(3, 6)",
            "attributes|5-10": [
              {
                name: '@pick(["å“ç‰Œ", "æè´¨", "äº§åœ°", "ä¿è´¨æœŸ", "é‡é‡"])',
                value: "@ctitle(2, 10)",
              },
            ],
          },
        ],
        total: 200,
        page: 1,
        pageSize: 20,
      },
    };
  });

  // è·å–å•†å“è¯¦æƒ…
  Mock.mock(/\/api\/mall\/product\/\d+/, "get", () => {
    return {
      code: 200,
      message: "è·å–æˆåŠŸ",
      data: {
        id: "@id",
        name: "@ctitle(5, 20)",
        subtitle: "@ctitle(10, 30)",
        "images|5-12": ["@image(800x800)"],
        "detailImages|3-8": ["@image(750x1000)"],
        categoryId: "@pick([1, 2, 3, 4])",
        price: "@float(19.9, 199.9, 1, 1)",
        memberPrice: "@float(15.9, 159.9, 1, 1)",
        originalPrice: "@float(29.9, 299.9, 1, 1)",
        stock: "@integer(10, 1000)",
        sales: "@integer(0, 9999)",
        rating: "@float(4.0, 5.0, 1, 1)",
        "reviewCount|10-999": 1,
        "tags|0-4": [
          '@pick(["çƒ­é”€", "æ–°å“", "ç‰¹æƒ ", "é™æ—¶", "åŒ…é‚®", "æ­£å“", "ä¸ƒå¤©é€€æ¢"])',
        ],
        "specs|2-4": [
          {
            name: '@pick(["é¢œè‰²", "å°ºå¯¸", "è§„æ ¼", "å‹å·"])',
            "options|2-6": [
              {
                name: '@pick(["çº¢è‰²", "è“è‰²", "é»‘è‰²", "ç™½è‰²", "S", "M", "L", "XL", "æ ‡å‡†ç‰ˆ", "è±ªåç‰ˆ"])',
                image: "@image(60x60)",
                price: "@float(0, 50, 1, 1)", // è§„æ ¼ä»·æ ¼å·®
                stock: "@integer(0, 100)",
              },
            ],
          },
        ],
        description: "@cparagraph(5, 10)",
        "attributes|8-15": [
          {
            name: '@pick(["å“ç‰Œ", "æè´¨", "äº§åœ°", "ä¿è´¨æœŸ", "é‡é‡", "å°ºå¯¸", "é¢œè‰²", "æ¬¾å¼", "é€‚ç”¨äººç¾¤", "ä½¿ç”¨æ–¹æ³•"])',
            value: "@ctitle(2, 15)",
          },
        ],
        "reviews|15": [
          {
            id: "@id",
            user: {
              nickname: "@cname",
              avatar: "@image(50x50)",
              memberLevel: "@integer(1, 5)",
            },
            rating: "@float(3.0, 5.0, 1, 1)",
            content: "@cparagraph(1, 4)",
            "images|0-9": ["@image(150x150)"],
            specs: "@ctitle(5, 15)", // è´­ä¹°è§„æ ¼
            createTime: '@datetime("yyyy-MM-dd HH:mm:ss")',
            "tags|0-3": [
              '@pick(["è´¨é‡å¥½", "ç‰©æµå¿«", "åŒ…è£…å¥½", "æ€§ä»·æ¯”é«˜", "å€¼å¾—è´­ä¹°", "æ¨è"])',
            ],
            helpful: "@integer(0, 50)", // æœ‰ç”¨æ•°
          },
        ],
      },
    };
  });

  // è·å–è´­ç‰©è½¦åˆ—è¡¨
  Mock.mock(/\/api\/mall\/cart/, "get", () => {
    return {
      code: 200,
      message: "è·å–æˆåŠŸ",
      data: {
        "items|3-8": [
          {
            id: "@id",
            productId: "@id",
            name: "@ctitle(5, 20)",
            image: "@image(200x200)",
            price: "@float(19.9, 199.9, 1, 1)",
            memberPrice: "@float(15.9, 159.9, 1, 1)",
            specs: "@ctitle(5, 15)",
            quantity: "@integer(1, 5)",
            stock: "@integer(10, 100)",
            selected: "@boolean",
          },
        ],
        totalAmount: "@float(100, 800, 2, 2)",
        totalCount: "@integer(3, 20)",
        selectedCount: "@integer(1, 15)",
      },
    };
  });
}
```

### 4.4 è‡ªå®šä¹‰åº•éƒ¨å¯¼èˆªç»„ä»¶

**components/layout/CustomTabBar.vueï¼š**

```vue
<template>
  <view class="custom-tab-bar">
    <view
      v-for="(item, index) in tabList"
      :key="index"
      class="tab-item"
      :class="{ active: current === index, center: item.center }"
      @click="switchTab(index)"
    >
      <view
        class="tab-icon"
        :class="{ 'animate__animated animate__pulse': current === index }"
      >
        <uni-icons
          :type="current === index ? item.selectedIconType : item.iconType"
          :size="item.center ? 36 : 24"
          :color="current === index ? activeColor : inactiveColor"
        />
      </view>
      <text
        class="tab-text"
        :style="{ color: current === index ? activeColor : inactiveColor }"
      >
        {{ item.text }}
      </text>
    </view>
  </view>
</template>

<script setup>
import { ref, onMounted } from "vue";

const props = defineProps({
  current: {
    type: Number,
    default: 0,
  },
});

const emit = defineEmits(["change"]);

// ä¸»é¢˜è‰²é…ç½®
const activeColor = "#8B5CF6"; // ç´«è‰²
const inactiveColor = "#999999";

// æ ‡ç­¾é…ç½®
const tabList = [
  {
    iconType: "home",
    selectedIconType: "home-filled",
    text: "é¦–é¡µ",
    pagePath: "/pages/index/index",
  },
  {
    iconType: "shop",
    selectedIconType: "shop-filled",
    text: "å•†åŸ",
    pagePath: "/pages/mall/index",
  },
  {
    iconType: "scan",
    selectedIconType: "scan",
    text: "æ‰«ä¸€æ‰«",
    pagePath: "/pages/scan/index",
    center: true,
  },
  {
    iconType: "wallet",
    selectedIconType: "wallet-filled",
    text: "èµšé’±",
    pagePath: "/pages/distribution/index",
  },
  {
    iconType: "person",
    selectedIconType: "person-filled",
    text: "æˆ‘çš„",
    pagePath: "/pages/user/index",
  },
];

const switchTab = (index) => {
  if (index === props.current) return;

  const tabItem = tabList[index];

  // æ‰«ä¸€æ‰«ç‰¹æ®Šå¤„ç†
  if (tabItem.text === "æ‰«ä¸€æ‰«") {
    uni.navigateTo({
      url: tabItem.pagePath,
    });
    return;
  }

  // å…¶ä»–é¡µé¢ä½¿ç”¨switchTab
  uni.switchTab({
    url: tabItem.pagePath,
    success: () => {
      emit("change", index);
    },
  });
};
</script>

<style lang="scss" scoped>
.custom-tab-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 100rpx;
  background: #ffffff;
  border-top: 1rpx solid #ebeef5;
  display: flex;
  align-items: center;
  justify-content: space-around;
  padding-bottom: env(safe-area-inset-bottom);
  z-index: 1000;

  .tab-item {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
    padding: 10rpx 0;

    &.center {
      .tab-icon {
        width: 80rpx;
        height: 80rpx;
        border-radius: 50%;
        background: linear-gradient(135deg, #8b5cf6, #ec4899);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 8rpx;
        box-shadow: 0 4rpx 12rpx rgba(139, 92, 246, 0.3);
        transform: translateY(-10rpx);
      }

      .tab-text {
        color: #8b5cf6 !important;
        font-weight: 500;
      }
    }

    &.active:not(.center) {
      .tab-icon {
        transform: scale(1.1);
      }
    }

    .tab-icon {
      margin-bottom: 4rpx;
      transition: all 0.3s ease;
    }

    .tab-text {
      font-size: 20rpx;
      transition: color 0.3s ease;
    }
  }
}
</style>
```

### 4.5 å›¾æ ‡ç»„ä»¶é›†æˆ

**å®‰è£…å›¾æ ‡ç›¸å…³ä¾èµ–ï¼š**

```bash
npm install @iconify/vue @iconify/json
```

**components/common/Icon.vueï¼š**

```vue
<template>
  <span
    class="custom-icon"
    :style="iconStyle"
    :class="{ animate__animated: animation }"
    :class="animation"
  >
    <Icon
      :icon="`mynaui:${name}`"
      :width="size"
      :height="size"
      :color="color"
    />
  </span>
</template>

<script setup>
import { Icon } from "@iconify/vue";
import { computed } from "vue";

const props = defineProps({
  name: {
    type: String,
    required: true,
  },
  size: {
    type: [Number, String],
    default: 24,
  },
  color: {
    type: String,
    default: "#333333",
  },
  animation: {
    type: String,
    default: "",
  },
});

const iconStyle = computed(() => {
  return {
    display: "inline-flex",
    alignItems: "center",
    justifyContent: "center",
  };
});
</script>

<style lang="scss" scoped>
.custom-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
}
</style>
```

### 4.6 ç»„åˆå¼å‡½æ•°ç¤ºä¾‹

**composables/useAuth.jsï¼š**

```javascript
import { ref, computed } from "vue";
import { useUserStore } from "@/stores/user";
import { isWeixin } from "@/utils/weixin";

export function useAuth() {
  const userStore = useUserStore();
  const loading = ref(false);

  // æ‰‹æœºå·+éªŒè¯ç ç™»å½•
  const loginWithSms = async (phone, code) => {
    loading.value = true;
    try {
      const result = await userStore.loginWithSms({ phone, code });
      uni.showToast({
        title: "ç™»å½•æˆåŠŸ",
        icon: "success",
      });
      return result;
    } catch (error) {
      uni.showToast({
        title: error.message || "ç™»å½•å¤±è´¥",
        icon: "none",
      });
      throw error;
    } finally {
      loading.value = false;
    }
  };

  // å¾®ä¿¡æˆæƒç™»å½• (H5ç«¯)
  const loginWithWeixinH5 = async () => {
    if (!isWeixin()) {
      uni.showToast({
        title: "è¯·åœ¨å¾®ä¿¡ä¸­æ‰“å¼€",
        icon: "none",
      });
      return;
    }

    loading.value = true;
    try {
      // è·å–å¾®ä¿¡æˆæƒ
      const result = await userStore.loginWithWeixinH5();
      uni.showToast({
        title: "æˆæƒæˆåŠŸ",
        icon: "success",
      });
      return result;
    } catch (error) {
      uni.showToast({
        title: error.message || "æˆæƒå¤±è´¥",
        icon: "none",
      });
      throw error;
    } finally {
      loading.value = false;
    }
  };

  // å¾®ä¿¡æˆæƒç™»å½• (å°ç¨‹åºç«¯)
  const loginWithWeixinMp = async () => {
    // #ifdef MP-WEIXIN
    loading.value = true;
    try {
      // è·å–å¾®ä¿¡æˆæƒ
      const result = await userStore.loginWithWeixinMp();
      uni.showToast({
        title: "æˆæƒæˆåŠŸ",
        icon: "success",
      });
      return result;
    } catch (error) {
      uni.showToast({
        title: error.message || "æˆæƒå¤±è´¥",
        icon: "none",
      });
      throw error;
    } finally {
      loading.value = false;
    }
    // #endif
  };

  // å°ç¨‹åºå¿«é€ŸéªŒè¯æ‰‹æœºå·
  const getPhoneNumber = async (e) => {
    // #ifdef MP-WEIXIN
    if (e.detail.errMsg === "getPhoneNumber:ok") {
      loading.value = true;
      try {
        const result = await userStore.loginWithMpPhone(e.detail);
        uni.showToast({
          title: "ç™»å½•æˆåŠŸ",
          icon: "success",
        });
        return result;
      } catch (error) {
        uni.showToast({
          title: error.message || "è·å–æ‰‹æœºå·å¤±è´¥",
          icon: "none",
        });
        throw error;
      } finally {
        loading.value = false;
      }
    } else {
      uni.showToast({
        title: "å·²å–æ¶ˆæˆæƒ",
        icon: "none",
      });
    }
    // #endif
  };

  // å‘é€çŸ­ä¿¡éªŒè¯ç 
  const sendSmsCode = async (phone) => {
    try {
      await userStore.sendSmsCode(phone);
      uni.showToast({
        title: "éªŒè¯ç å·²å‘é€",
        icon: "success",
      });
    } catch (error) {
      uni.showToast({
        title: error.message || "å‘é€å¤±è´¥",
        icon: "none",
      });
      throw error;
    }
  };

  // é€€å‡ºç™»å½•
  const logout = () => {
    uni.showModal({
      title: "æç¤º",
      content: "ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ",
      success: (res) => {
        if (res.confirm) {
          userStore.logout();
          uni.showToast({
            title: "å·²é€€å‡ºç™»å½•",
            icon: "success",
          });
          // è·³è½¬åˆ°ç™»å½•é¡µé¢
          uni.reLaunch({
            url: "/pages/user/login",
          });
        }
      },
    });
  };

  // æ£€æŸ¥ç™»å½•çŠ¶æ€
  const checkAuth = () => {
    if (!userStore.isLogin) {
      uni.showModal({
        title: "æç¤º",
        content: "è¯·å…ˆç™»å½•",
        confirmText: "å»ç™»å½•",
        success: (res) => {
          if (res.confirm) {
            uni.navigateTo({
              url: "/pages/user/login",
            });
          }
        },
      });
      return false;
    }
    return true;
  };

  return {
    loading,
    isLogin: computed(() => userStore.isLogin),
    userInfo: computed(() => userStore.userInfo),
    loginWithSms,
    loginWithWeixinH5,
    loginWithWeixinMp,
    getPhoneNumber,
    sendSmsCode,
    logout,
    checkAuth,
  };
}
```

### 4.7 å¾®ä¿¡ SDK é›†æˆ

**utils/weixinSdk.jsï¼š**

```javascript
// H5ç«¯å¾®ä¿¡SDKé…ç½®
class WeixinSDK {
  constructor() {
    this.isReady = false;
    this.config = {
      debug: false,
      appId: "",
      timestamp: "",
      nonceStr: "",
      signature: "",
      jsApiList: [
        "updateAppMessageShareData",
        "updateTimelineShareData",
        "getLocation",
        "chooseImage",
        "uploadImage",
      ],
    };
  }

  // åˆå§‹åŒ–å¾®ä¿¡SDK
  async init(config) {
    return new Promise((resolve, reject) => {
      if (typeof wx === "undefined") {
        reject(new Error("å¾®ä¿¡JS-SDKæœªåŠ è½½"));
        return;
      }

      this.config = { ...this.config, ...config };

      wx.config(this.config);

      wx.ready(() => {
        this.isReady = true;
        resolve();
      });

      wx.error((err) => {
        reject(err);
      });
    });
  }

  // è·å–å¾®ä¿¡æˆæƒ
  async getWeixinAuth() {
    const appid = this.config.appId;
    const redirect_uri = encodeURIComponent(window.location.href);
    const state = "STATE";
    const scope = "snsapi_userinfo";

    const authUrl = `https://open.weixin.qq.com/connect/oauth2/authorize?appid=${appid}&redirect_uri=${redirect_uri}&response_type=code&scope=${scope}&state=${state}#wechat_redirect`;

    window.location.href = authUrl;
  }

  // åˆ†äº«åˆ°æœ‹å‹åœˆ
  shareToTimeline(shareData) {
    if (!this.isReady) {
      throw new Error("å¾®ä¿¡SDKæœªå°±ç»ª");
    }

    wx.updateTimelineShareData({
      title: shareData.title,
      link: shareData.link,
      imgUrl: shareData.imgUrl,
      success: shareData.success || (() => {}),
      cancel: shareData.cancel || (() => {}),
    });
  }

  // åˆ†äº«ç»™æœ‹å‹
  shareToFriend(shareData) {
    if (!this.isReady) {
      throw new Error("å¾®ä¿¡SDKæœªå°±ç»ª");
    }

    wx.updateAppMessageShareData({
      title: shareData.title,
      desc: shareData.desc,
      link: shareData.link,
      imgUrl: shareData.imgUrl,
      success: shareData.success || (() => {}),
      cancel: shareData.cancel || (() => {}),
    });
  }

  // è·å–åœ°ç†ä½ç½®
  getLocation() {
    return new Promise((resolve, reject) => {
      if (!this.isReady) {
        reject(new Error("å¾®ä¿¡SDKæœªå°±ç»ª"));
        return;
      }

      wx.getLocation({
        type: "wgs84",
        success: (res) => {
          resolve({
            latitude: res.latitude,
            longitude: res.longitude,
            speed: res.speed,
            accuracy: res.accuracy,
          });
        },
        fail: reject,
      });
    });
  }
}

export const weixinSDK = new WeixinSDK();
```

### 4.8 ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ

#### 4.8.1 é˜¿é‡Œäº‘ OSS å›¾ç‰‡ä¸Šä¼ 

**å®‰è£… OSS ç›¸å…³ä¾èµ–ï¼š**

```bash
npm install ali-oss crypto-js
```

**utils/ossUpload.jsï¼š**

```javascript
import OSS from "ali-oss";
import CryptoJS from "crypto-js";

class OSSUploader {
  constructor() {
    this.client = null;
    this.config = {
      region: process.env.VUE_APP_OSS_REGION || "oss-cn-shenzhen",
      bucket: process.env.VUE_APP_OSS_BUCKET || "your-bucket-name",
      accessKeyId: process.env.VUE_APP_OSS_ACCESS_KEY_ID,
      accessKeySecret: process.env.VUE_APP_OSS_ACCESS_KEY_SECRET,
      endpoint:
        process.env.VUE_APP_OSS_ENDPOINT ||
        "https://oss-cn-shenzhen.aliyuncs.com",
    };
  }

  // åˆå§‹åŒ–OSSå®¢æˆ·ç«¯
  initClient() {
    if (!this.client) {
      this.client = new OSS({
        region: this.config.region,
        bucket: this.config.bucket,
        accessKeyId: this.config.accessKeyId,
        accessKeySecret: this.config.accessKeySecret,
        endpoint: this.config.endpoint,
        secure: true,
      });
    }
    return this.client;
  }

  // ç”Ÿæˆæ–‡ä»¶å
  generateFileName(originalName, userId = "") {
    const timestamp = Date.now();
    const randomStr = Math.random().toString(36).substr(2, 9);
    const ext = originalName.split(".").pop();
    const hash = CryptoJS.MD5(`${userId}_${timestamp}_${randomStr}`).toString();
    return `uploads/${new Date().getFullYear()}/${
      new Date().getMonth() + 1
    }/${hash}.${ext}`;
  }

  // ä¸Šä¼ å•ä¸ªæ–‡ä»¶
  async uploadFile(file, options = {}) {
    try {
      const client = this.initClient();
      const fileName =
        options.fileName || this.generateFileName(file.name, options.userId);

      const result = await client.put(fileName, file, {
        headers: {
          "Content-Type": file.type || "application/octet-stream",
        },
      });

      return {
        success: true,
        url: result.url,
        name: fileName,
        size: file.size,
        type: file.type,
      };
    } catch (error) {
      console.error("OSSä¸Šä¼ å¤±è´¥:", error);
      return {
        success: false,
        error: error.message,
      };
    }
  }

  // æ‰¹é‡ä¸Šä¼ æ–‡ä»¶
  async uploadFiles(files, options = {}) {
    const uploadPromises = files.map((file) => this.uploadFile(file, options));
    const results = await Promise.allSettled(uploadPromises);

    return results.map((result, index) => {
      if (result.status === "fulfilled") {
        return result.value;
      } else {
        return {
          success: false,
          error: result.reason.message,
          file: files[index],
        };
      }
    });
  }

  // UniAppç¯å¢ƒä¸‹çš„å›¾ç‰‡ä¸Šä¼ 
  async uploadImage(options = {}) {
    return new Promise((resolve, reject) => {
      uni.chooseImage({
        count: options.count || 1,
        sourceType: options.sourceType || ["album", "camera"],
        success: async (res) => {
          try {
            const uploadResults = [];

            for (const tempFilePath of res.tempFilePaths) {
              // è·å–æ–‡ä»¶ä¿¡æ¯
              const fileInfo = await this.getFileInfo(tempFilePath);

              // ä½¿ç”¨STSä¸´æ—¶å‡­è¯ä¸Šä¼ ï¼ˆæ¨èæ–¹å¼ï¼‰
              const uploadResult = await this.uploadWithSTS(
                tempFilePath,
                fileInfo,
                options
              );
              uploadResults.push(uploadResult);
            }

            resolve(uploadResults);
          } catch (error) {
            reject(error);
          }
        },
        fail: (error) => {
          reject(error);
        },
      });
    });
  }

  // è·å–æ–‡ä»¶ä¿¡æ¯
  async getFileInfo(filePath) {
    return new Promise((resolve, reject) => {
      uni.getFileInfo({
        filePath,
        success: (res) => {
          resolve({
            size: res.size,
            path: filePath,
          });
        },
        fail: reject,
      });
    });
  }

  // ä½¿ç”¨STSä¸´æ—¶å‡­è¯ä¸Šä¼ ï¼ˆæ¨èæ–¹å¼ï¼‰
  async uploadWithSTS(filePath, fileInfo, options = {}) {
    try {
      // ä»åç«¯è·å–STSä¸´æ—¶å‡­è¯
      const stsToken = await this.getSTS();

      const fileName =
        options.fileName ||
        this.generateFileName(`image_${Date.now()}.jpg`, options.userId);

      return new Promise((resolve, reject) => {
        uni.uploadFile({
          url: `${this.config.endpoint}/${this.config.bucket}`,
          filePath: filePath,
          name: "file",
          formData: {
            key: fileName,
            policy: stsToken.policy,
            OSSAccessKeyId: stsToken.accessKeyId,
            signature: stsToken.signature,
            "x-oss-security-token": stsToken.securityToken,
            success_action_status: "200",
          },
          success: (res) => {
            if (res.statusCode === 200) {
              resolve({
                success: true,
                url: `${this.config.endpoint}/${this.config.bucket}/${fileName}`,
                name: fileName,
                size: fileInfo.size,
              });
            } else {
              reject(new Error("ä¸Šä¼ å¤±è´¥"));
            }
          },
          fail: reject,
        });
      });
    } catch (error) {
      throw new Error(`STSä¸Šä¼ å¤±è´¥: ${error.message}`);
    }
  }

  // è·å–STSä¸´æ—¶å‡­è¯
  async getSTS() {
    // è¿™é‡Œåº”è¯¥è°ƒç”¨åç«¯APIè·å–STSä¸´æ—¶å‡­è¯
    // ç¤ºä¾‹ä»£ç 
    const response = await uni.request({
      url: "/api/oss/sts",
      method: "GET",
    });

    if (response.data.code === 200) {
      return response.data.data;
    } else {
      throw new Error("è·å–STSå‡­è¯å¤±è´¥");
    }
  }

  // åˆ é™¤æ–‡ä»¶
  async deleteFile(fileName) {
    try {
      const client = this.initClient();
      await client.delete(fileName);
      return { success: true };
    } catch (error) {
      console.error("åˆ é™¤æ–‡ä»¶å¤±è´¥:", error);
      return { success: false, error: error.message };
    }
  }

  // è·å–ç­¾åURLï¼ˆç”¨äºç§æœ‰æ–‡ä»¶è®¿é—®ï¼‰
  getSignedUrl(fileName, expires = 3600) {
    try {
      const client = this.initClient();
      return client.signatureUrl(fileName, { expires });
    } catch (error) {
      console.error("ç”Ÿæˆç­¾åURLå¤±è´¥:", error);
      return null;
    }
  }
}

export const ossUploader = new OSSUploader();

// ç»„åˆå¼å‡½æ•°
export function useOSSUpload() {
  const uploading = ref(false);
  const uploadProgress = ref(0);

  const uploadImage = async (options = {}) => {
    uploading.value = true;
    uploadProgress.value = 0;

    try {
      const result = await ossUploader.uploadImage(options);
      uploadProgress.value = 100;
      return result;
    } catch (error) {
      throw error;
    } finally {
      uploading.value = false;
      uploadProgress.value = 0;
    }
  };

  const uploadFile = async (file, options = {}) => {
    uploading.value = true;
    uploadProgress.value = 0;

    try {
      const result = await ossUploader.uploadFile(file, options);
      uploadProgress.value = 100;
      return result;
    } catch (error) {
      throw error;
    } finally {
      uploading.value = false;
      uploadProgress.value = 0;
    }
  };

  return {
    uploading: readonly(uploading),
    uploadProgress: readonly(uploadProgress),
    uploadImage,
    uploadFile,
  };
}
```

#### 4.8.2 å›¾ç‰‡ä¸Šä¼ ç»„ä»¶

**components/common/ImageUploader.vueï¼š**

```vue
<template>
  <view class="image-uploader">
    <view class="upload-list">
      <view v-for="(item, index) in imageList" :key="index" class="upload-item">
        <image
          :src="item.url"
          mode="aspectFill"
          class="upload-image"
          @click="previewImage(index)"
        />
        <view class="delete-btn" @click="deleteImage(index)">
          <uni-icons type="close" size="16" color="#fff" />
        </view>
        <view v-if="item.uploading" class="upload-progress">
          <view
            class="progress-bar"
            :style="{ width: item.progress + '%' }"
          ></view>
        </view>
      </view>

      <view
        v-if="imageList.length < maxCount"
        class="upload-btn"
        @click="chooseImage"
      >
        <uni-icons type="camera" size="32" color="#999" />
        <text class="upload-text">ä¸Šä¼ å›¾ç‰‡</text>
      </view>
    </view>
  </view>
</template>

<script setup>
import { ref, watch } from "vue";
import { useOSSUpload } from "@/utils/ossUpload";

const props = defineProps({
  modelValue: {
    type: Array,
    default: () => [],
  },
  maxCount: {
    type: Number,
    default: 9,
  },
  maxSize: {
    type: Number,
    default: 5 * 1024 * 1024, // 5MB
  },
  compress: {
    type: Boolean,
    default: true,
  },
});

const emit = defineEmits([
  "update:modelValue",
  "upload-success",
  "upload-error",
]);

const { uploadImage, uploading } = useOSSUpload();
const imageList = ref([...props.modelValue]);

// é€‰æ‹©å›¾ç‰‡
const chooseImage = () => {
  const remainCount = props.maxCount - imageList.value.length;

  uni.chooseImage({
    count: remainCount,
    sourceType: ["album", "camera"],
    success: async (res) => {
      for (const tempFilePath of res.tempFilePaths) {
        // æ£€æŸ¥æ–‡ä»¶å¤§å°
        const fileInfo = await getFileInfo(tempFilePath);
        if (fileInfo.size > props.maxSize) {
          uni.showToast({
            title: "å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB",
            icon: "none",
          });
          continue;
        }

        // æ·»åŠ åˆ°åˆ—è¡¨å¹¶å¼€å§‹ä¸Šä¼ 
        const uploadItem = {
          url: tempFilePath,
          uploading: true,
          progress: 0,
        };

        imageList.value.push(uploadItem);

        try {
          const result = await uploadImage({
            compress: props.compress,
            count: 1,
          });

          if (result[0].success) {
            uploadItem.url = result[0].url;
            uploadItem.uploading = false;
            uploadItem.progress = 100;
            emit("upload-success", result[0]);
          } else {
            // ä¸Šä¼ å¤±è´¥ï¼Œç§»é™¤è¯¥é¡¹
            const index = imageList.value.indexOf(uploadItem);
            imageList.value.splice(index, 1);
            emit("upload-error", result[0].error);
            uni.showToast({
              title: "ä¸Šä¼ å¤±è´¥",
              icon: "none",
            });
          }
        } catch (error) {
          // ä¸Šä¼ å¤±è´¥ï¼Œç§»é™¤è¯¥é¡¹
          const index = imageList.value.indexOf(uploadItem);
          imageList.value.splice(index, 1);
          emit("upload-error", error.message);
          uni.showToast({
            title: "ä¸Šä¼ å¤±è´¥",
            icon: "none",
          });
        }
      }
    },
  });
};

// è·å–æ–‡ä»¶ä¿¡æ¯
const getFileInfo = (filePath) => {
  return new Promise((resolve, reject) => {
    uni.getFileInfo({
      filePath,
      success: resolve,
      fail: reject,
    });
  });
};

// åˆ é™¤å›¾ç‰‡
const deleteImage = (index) => {
  imageList.value.splice(index, 1);
};

// é¢„è§ˆå›¾ç‰‡
const previewImage = (index) => {
  const urls = imageList.value
    .filter((item) => !item.uploading)
    .map((item) => item.url);

  uni.previewImage({
    current: index,
    urls,
  });
};

// ç›‘å¬å˜åŒ–å¹¶åŒæ­¥åˆ°çˆ¶ç»„ä»¶
watch(
  imageList,
  (newList) => {
    const validList = newList
      .filter((item) => !item.uploading)
      .map((item) => ({ url: item.url }));
    emit("update:modelValue", validList);
  },
  { deep: true }
);

watch(
  () => props.modelValue,
  (newValue) => {
    imageList.value = [...newValue];
  },
  { deep: true }
);
</script>

<style lang="scss" scoped>
.image-uploader {
  .upload-list {
    display: flex;
    flex-wrap: wrap;
    gap: 16rpx;
  }

  .upload-item {
    position: relative;
    width: 200rpx;
    height: 200rpx;
    border-radius: 12rpx;
    overflow: hidden;

    .upload-image {
      width: 100%;
      height: 100%;
    }

    .delete-btn {
      position: absolute;
      top: -8rpx;
      right: -8rpx;
      width: 32rpx;
      height: 32rpx;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .upload-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 6rpx;
      background: rgba(0, 0, 0, 0.3);

      .progress-bar {
        height: 100%;
        background: #8b5cf6;
        transition: width 0.3s ease;
      }
    }
  }

  .upload-btn {
    width: 200rpx;
    height: 200rpx;
    border: 2rpx dashed #ddd;
    border-radius: 12rpx;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 16rpx;

    .upload-text {
      font-size: 24rpx;
      color: #999;
    }
  }
}
</style>
```

## äº”ã€æ ·å¼è§„èŒƒ

### 5.1 å…¨å±€æ ·å¼å˜é‡

**styles/variables.scssï¼š**

```scss
// ä¸»é¢˜è‰²å½©
$primary-color: #8b5cf6;
$secondary-color: #ec4899;
$accent-color: #f472b6;

// ä¸­æ€§è‰²
$text-color-primary: #333333;
$text-color-regular: #666666;
$text-color-secondary: #999999;
$text-color-placeholder: #c0c4cc;

// èƒŒæ™¯è‰²
$bg-color-primary: #ffffff;
$bg-color-secondary: #f8f9fa;
$bg-color-tertiary: #f5f5f5;

// è¾¹æ¡†è‰²
$border-color-light: #ebeef5;
$border-color-base: #dcdfe6;
$border-color-dark: #c0c4cc;

// æˆåŠŸã€è­¦å‘Šã€å±é™©è‰²
$success-color: #67c23a;
$warning-color: #e6a23c;
$danger-color: #f56c6c;
$info-color: #909399;

// å­—ä½“å¤§å°
$font-size-large: 32rpx;
$font-size-medium: 28rpx;
$font-size-base: 24rpx;
$font-size-small: 20rpx;
$font-size-mini: 16rpx;

// é—´è·
$spacing-mini: 8rpx;
$spacing-small: 16rpx;
$spacing-base: 24rpx;
$spacing-large: 32rpx;
$spacing-xl: 48rpx;

// åœ†è§’
$border-radius-small: 8rpx;
$border-radius-base: 12rpx;
$border-radius-large: 16rpx;
$border-radius-round: 50%;

// é˜´å½±
$box-shadow-light: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);
$box-shadow-base: 0 4rpx 16rpx rgba(0, 0, 0, 0.1);
$box-shadow-dark: 0 8rpx 24rpx rgba(0, 0, 0, 0.15);

// å±‚çº§
$z-index-mask: 1000;
$z-index-popup: 1100;
$z-index-modal: 1200;
$z-index-toast: 1300;
$z-index-top: 1400;
```

### 5.2 å…¨å±€æ ·å¼

**styles/index.scssï¼š**

```scss
@import "./variables.scss";
@import "./mixins.scss";
@import "./normalize.scss";
@import "animate.css";

// å…¨å±€æ ·å¼
page {
  background-color: $bg-color-secondary;
  font-size: $font-size-base;
  color: $text-color-primary;
  line-height: 1.6;
}

// å¸ƒå±€ç±»
.container {
  padding: 0 $spacing-base;
}

.flex {
  display: flex;

  &-row {
    flex-direction: row;
  }

  &-column {
    flex-direction: column;
  }

  &-center {
    justify-content: center;
    align-items: center;
  }

  &-between {
    justify-content: space-between;
  }

  &-around {
    justify-content: space-around;
  }

  &-wrap {
    flex-wrap: wrap;
  }
}

// æ–‡å­—ç±»
.text {
  &-primary {
    color: $text-color-primary;
  }

  &-regular {
    color: $text-color-regular;
  }

  &-secondary {
    color: $text-color-secondary;
  }

  &-placeholder {
    color: $text-color-placeholder;
  }

  &-success {
    color: $success-color;
  }

  &-warning {
    color: $warning-color;
  }

  &-danger {
    color: $danger-color;
  }

  &-info {
    color: $info-color;
  }
}

// èƒŒæ™¯ç±»
.bg {
  &-white {
    background-color: $bg-color-primary;
  }

  &-gray {
    background-color: $bg-color-secondary;
  }

  &-primary {
    background-color: $primary-color;
  }

  &-secondary {
    background-color: $secondary-color;
  }
}

// é—´è·ç±»
@for $i from 1 through 10 {
  .margin-#{$i} {
    margin: #{$i * 8}rpx;
  }

  .margin-top-#{$i} {
    margin-top: #{$i * 8}rpx;
  }

  .margin-bottom-#{$i} {
    margin-bottom: #{$i * 8}rpx;
  }

  .margin-left-#{$i} {
    margin-left: #{$i * 8}rpx;
  }

  .margin-right-#{$i} {
    margin-right: #{$i * 8}rpx;
  }

  .padding-#{$i} {
    padding: #{$i * 8}rpx;
  }

  .padding-top-#{$i} {
    padding-top: #{$i * 8}rpx;
  }

  .padding-bottom-#{$i} {
    padding-bottom: #{$i * 8}rpx;
  }

  .padding-left-#{$i} {
    padding-left: #{$i * 8}rpx;
  }

  .padding-right-#{$i} {
    padding-right: #{$i * 8}rpx;
  }
}

// åœ†è§’ç±»
.border-radius {
  &-small {
    border-radius: $border-radius-small;
  }

  &-base {
    border-radius: $border-radius-base;
  }

  &-large {
    border-radius: $border-radius-large;
  }

  &-round {
    border-radius: $border-radius-round;
  }
}

// é˜´å½±ç±»
.shadow {
  &-light {
    box-shadow: $box-shadow-light;
  }

  &-base {
    box-shadow: $box-shadow-base;
  }

  &-dark {
    box-shadow: $box-shadow-dark;
  }
}
```

### 5.3 æ··åˆæ ·å¼

**styles/mixins.scssï¼š**

```scss
// æ¸…é™¤æµ®åŠ¨
@mixin clearfix {
  &::after {
    content: "";
    display: table;
    clear: both;
  }
}

// å•è¡Œæ–‡æœ¬æº¢å‡º
@mixin text-overflow {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

// å¤šè¡Œæ–‡æœ¬æº¢å‡º
@mixin text-overflow-multi($lines: 2) {
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: $lines;
  overflow: hidden;
  text-overflow: ellipsis;
}

// å±…ä¸­å®šä½
@mixin center($position: absolute) {
  position: $position;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

// æŒ‰é’®æ ·å¼
@mixin button($bg-color: $primary-color, $text-color: #ffffff) {
  background-color: $bg-color;
  color: $text-color;
  border: none;
  border-radius: $border-radius-base;
  padding: $spacing-small $spacing-base;
  font-size: $font-size-base;
  transition: all 0.3s ease;

  &:active {
    opacity: 0.8;
    transform: scale(0.98);
  }

  &:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
}

// å¡ç‰‡æ ·å¼
@mixin card {
  background-color: $bg-color-primary;
  border-radius: $border-radius-base;
  box-shadow: $box-shadow-light;
  padding: $spacing-base;
  margin-bottom: $spacing-base;
}

// æ¸å˜èƒŒæ™¯
@mixin gradient(
  $start-color: $primary-color,
  $end-color: $secondary-color,
  $direction: 135deg
) {
  background: linear-gradient($direction, $start-color, $end-color);
}

// å“åº”å¼
@mixin respond-to($breakpoint) {
  @if $breakpoint == "phone" {
    @media (max-width: 767px) {
      @content;
    }
  }

  @if $breakpoint == "tablet" {
    @media (min-width: 768px) and (max-width: 1023px) {
      @content;
    }
  }

  @if $breakpoint == "desktop" {
    @media (min-width: 1024px) {
      @content;
    }
  }
}
```

## å…­ã€å¼€å‘è§„èŒƒ

### 6.1 ä»£ç è§„èŒƒ

**ESLint é…ç½®ï¼ˆ.eslintrc.jsï¼‰ï¼š**

```javascript
module.exports = {
  env: {
    browser: true,
    es2021: true,
    node: true,
  },
  extends: [
    "eslint:recommended",
    "@vue/eslint-config-typescript",
    "plugin:vue/vue3-essential",
  ],
  parserOptions: {
    ecmaVersion: "latest",
    sourceType: "module",
  },
  plugins: ["vue"],
  rules: {
    // ç¼©è¿›ä½¿ç”¨2ä¸ªç©ºæ ¼
    indent: ["error", 2],
    // å­—ç¬¦ä¸²ä½¿ç”¨å•å¼•å·
    quotes: ["error", "single"],
    // è¯­å¥æœ«å°¾å¿…é¡»æœ‰åˆ†å·
    semi: ["error", "always"],
    // ç¦æ­¢ä½¿ç”¨var
    "no-var": "error",
    // ä¼˜å…ˆä½¿ç”¨const
    "prefer-const": "error",
    // å¯¹è±¡å­—é¢é‡çš„é”®å€¼ä¹‹é—´å¿…é¡»æœ‰ç©ºæ ¼
    "key-spacing": ["error", { beforeColon: false, afterColon: true }],
    // é€—å·å‰ç¦æ­¢æœ‰ç©ºæ ¼ï¼Œé€—å·åå¿…é¡»æœ‰ç©ºæ ¼
    "comma-spacing": ["error", { before: false, after: true }],
    // ç¦æ­¢ä½¿ç”¨console.logï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
    "no-console": process.env.NODE_ENV === "production" ? "warn" : "off",
    // ç¦æ­¢ä½¿ç”¨debuggerï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
    "no-debugger": process.env.NODE_ENV === "production" ? "warn" : "off",
    // Vueç‰¹å®šè§„åˆ™
    "vue/multi-word-component-names": "off",
    "vue/no-unused-vars": "error",
  },
  globals: {
    uni: "readonly",
    plus: "readonly",
    wx: "readonly",
  },
};
```

### 6.2 å‘½åè§„èŒƒ

**æ–‡ä»¶å‘½åï¼š**

- é¡µé¢æ–‡ä»¶ï¼šä½¿ç”¨ kebab-caseï¼Œå¦‚ `hotel-list.vue`
- ç»„ä»¶æ–‡ä»¶ï¼šä½¿ç”¨ PascalCaseï¼Œå¦‚ `CustomButton.vue`
- å·¥å…·æ–‡ä»¶ï¼šä½¿ç”¨ camelCaseï¼Œå¦‚ `formatDate.js`
- æ ·å¼æ–‡ä»¶ï¼šä½¿ç”¨ kebab-caseï¼Œå¦‚ `common-styles.scss`

**å˜é‡å‘½åï¼š**

```javascript
// å¸¸é‡ä½¿ç”¨å¤§å†™å­—æ¯å’Œä¸‹åˆ’çº¿
const API_BASE_URL = "https://api.example.com";

// å˜é‡å’Œå‡½æ•°ä½¿ç”¨camelCase
const userName = "john";
const getUserInfo = () => {};

// ç±»åä½¿ç”¨PascalCase
class UserService {}

// ç§æœ‰å˜é‡ä½¿ç”¨ä¸‹åˆ’çº¿å‰ç¼€
const _privateVar = "private";
```

**CSS ç±»åï¼š**

```scss
// ä½¿ç”¨BEMå‘½åæ³•
.hotel-card {
  &__header {
    // ...
  }

  &__content {
    // ...
  }

  &--featured {
    // ...
  }
}
```

### 6.3 ç»„ä»¶å¼€å‘è§„èŒƒ

**ç»„ä»¶ç»“æ„ï¼š**

```vue
<template>
  <!-- æ¨¡æ¿å†…å®¹ -->
</template>

<script setup>
// 1. å¯¼å…¥ä¾èµ–
import { ref, computed, onMounted } from "vue";

// 2. å®šä¹‰props
const props = defineProps({
  title: {
    type: String,
    required: true,
  },
});

// 3. å®šä¹‰emits
const emit = defineEmits(["change"]);

// 4. å“åº”å¼æ•°æ®
const loading = ref(false);

// 5. è®¡ç®—å±æ€§
const formattedTitle = computed(() => {
  return props.title.toUpperCase();
});

// 6. æ–¹æ³•
const handleClick = () => {
  emit("change", "value");
};

// 7. ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  // åˆå§‹åŒ–é€»è¾‘
});
</script>

<style lang="scss" scoped>
// æ ·å¼å†…å®¹
</style>
```

### 6.4 Git æäº¤è§„èŒƒ

**æäº¤æ¶ˆæ¯æ ¼å¼ï¼š**

```
<type>(<scope>): <subject>

<body>

<footer>
```

**ç±»å‹è¯´æ˜ï¼š**

- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤ bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼åŒ–
- `refactor`: ä»£ç é‡æ„
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

**ç¤ºä¾‹ï¼š**

```bash
git commit -m "feat(hotel): æ·»åŠ é…’åº—åˆ—è¡¨é¡µé¢"
git commit -m "fix(user): ä¿®å¤ç™»å½•çŠ¶æ€åˆ¤æ–­é—®é¢˜"
git commit -m "docs(readme): æ›´æ–°é¡¹ç›®æ–‡æ¡£"
```

## ä¸ƒã€æ€§èƒ½ä¼˜åŒ–

### 7.1 ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½

```javascript
// è·¯ç”±æ‡’åŠ è½½
const routes = [
  {
    path: "/hotel/detail",
    component: () => import("@/pages/hotel/detail.vue"),
  },
];

// ç»„ä»¶æ‡’åŠ è½½
const LazyComponent = defineAsyncComponent(() =>
  import("@/components/HeavyComponent.vue")
);
```

### 7.2 å›¾ç‰‡ä¼˜åŒ–

```javascript
// å›¾ç‰‡æ‡’åŠ è½½ç»„ä»¶
// components/common/LazyImage.vue
<template>
  <image
    :src="loaded ? src : placeholder"
    :lazy-load="true"
    @load="onLoad"
    @error="onError"
    :style="imageStyle"
  />
</template>

<script setup>
import { ref, computed } from 'vue';

const props = defineProps({
  src: String,
  placeholder: {
    type: String,
    default: '/static/images/placeholder.png'
  },
  width: [String, Number],
  height: [String, Number]
});

const loaded = ref(false);

const imageStyle = computed(() => ({
  width: typeof props.width === 'number' ? `${props.width}rpx` : props.width,
  height: typeof props.height === 'number' ? `${props.height}rpx` : props.height
}));

const onLoad = () => {
  loaded.value = true;
};

const onError = () => {
  console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', props.src);
};
</script>
```

### 7.3 Redis ç¼“å­˜ç­–ç•¥

å‰ç«¯éœ€è¦å……åˆ†åˆ©ç”¨ Redis ç¼“å­˜æœºåˆ¶æ¥æå‡æ€§èƒ½ï¼ŒåŒ…æ‹¬æœ¬åœ°ç¼“å­˜å’ŒæœåŠ¡ç«¯ç¼“å­˜çš„é…åˆä½¿ç”¨ã€‚

#### 7.3.1 å‰ç«¯ç¼“å­˜ç®¡ç†å™¨

```javascript
// utils/cache.js
class CacheManager {
  constructor() {
    this.localCache = new Map();
    this.expireTime = new Map();
    this.persistentKeys = new Set(); // æŒä¹…åŒ–ç¼“å­˜é”®
  }

  // è®¾ç½®ç¼“å­˜ï¼ˆæ”¯æŒRedisç¼“å­˜ï¼‰
  async set(key, value, options = {}) {
    const {
      expire = 300000, // é»˜è®¤5åˆ†é’Ÿ
      persistent = false, // æ˜¯å¦æŒä¹…åŒ–åˆ°æœ¬åœ°å­˜å‚¨
      redis = true, // æ˜¯å¦åŒæ­¥åˆ°Redis
    } = options;

    // æœ¬åœ°å†…å­˜ç¼“å­˜
    this.localCache.set(key, value);
    this.expireTime.set(key, Date.now() + expire);

    // æŒä¹…åŒ–åˆ°æœ¬åœ°å­˜å‚¨
    if (persistent) {
      this.persistentKeys.add(key);
      try {
        uni.setStorageSync(`cache_${key}`, {
          value,
          expire: Date.now() + expire,
          timestamp: Date.now(),
        });
      } catch (error) {
        console.warn("æœ¬åœ°ç¼“å­˜å­˜å‚¨å¤±è´¥:", error);
      }
    }

    // åŒæ­¥åˆ°Redisï¼ˆé€šè¿‡APIï¼‰
    if (redis) {
      try {
        await this.syncToRedis(key, value, expire);
      } catch (error) {
        console.warn("Redisç¼“å­˜åŒæ­¥å¤±è´¥:", error);
      }
    }
  }

  // è·å–ç¼“å­˜ï¼ˆä¼˜å…ˆçº§ï¼šå†…å­˜ > æœ¬åœ°å­˜å‚¨ > Redisï¼‰
  async get(key, fetchFromRedis = true) {
    // 1. æ£€æŸ¥å†…å­˜ç¼“å­˜
    if (!this.isExpired(key) && this.localCache.has(key)) {
      return this.localCache.get(key);
    }

    // 2. æ£€æŸ¥æœ¬åœ°å­˜å‚¨
    if (this.persistentKeys.has(key)) {
      try {
        const cached = uni.getStorageSync(`cache_${key}`);
        if (cached && cached.expire > Date.now()) {
          // æ¢å¤åˆ°å†…å­˜ç¼“å­˜
          this.localCache.set(key, cached.value);
          this.expireTime.set(key, cached.expire);
          return cached.value;
        }
      } catch (error) {
        console.warn("æœ¬åœ°ç¼“å­˜è¯»å–å¤±è´¥:", error);
      }
    }

    // 3. ä»Redisè·å–
    if (fetchFromRedis) {
      try {
        const redisValue = await this.getFromRedis(key);
        if (redisValue !== null) {
          // æ›´æ–°æœ¬åœ°ç¼“å­˜
          this.localCache.set(key, redisValue);
          this.expireTime.set(key, Date.now() + 300000); // é»˜è®¤5åˆ†é’Ÿ
          return redisValue;
        }
      } catch (error) {
        console.warn("Redisç¼“å­˜è·å–å¤±è´¥:", error);
      }
    }

    return null;
  }

  // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
  isExpired(key) {
    const expireTime = this.expireTime.get(key);
    return expireTime && Date.now() > expireTime;
  }

  // åˆ é™¤ç¼“å­˜
  async delete(key) {
    this.localCache.delete(key);
    this.expireTime.delete(key);

    // åˆ é™¤æœ¬åœ°å­˜å‚¨
    if (this.persistentKeys.has(key)) {
      this.persistentKeys.delete(key);
      try {
        uni.removeStorageSync(`cache_${key}`);
      } catch (error) {
        console.warn("æœ¬åœ°ç¼“å­˜åˆ é™¤å¤±è´¥:", error);
      }
    }

    // åˆ é™¤Redisç¼“å­˜
    try {
      await this.deleteFromRedis(key);
    } catch (error) {
      console.warn("Redisç¼“å­˜åˆ é™¤å¤±è´¥:", error);
    }
  }

  // æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
  async clear() {
    this.localCache.clear();
    this.expireTime.clear();

    // æ¸…ç©ºæœ¬åœ°å­˜å‚¨ç¼“å­˜
    for (const key of this.persistentKeys) {
      try {
        uni.removeStorageSync(`cache_${key}`);
      } catch (error) {
        console.warn("æœ¬åœ°ç¼“å­˜æ¸…ç©ºå¤±è´¥:", error);
      }
    }
    this.persistentKeys.clear();

    // æ¸…ç©ºRedisç¼“å­˜
    try {
      await this.clearRedis();
    } catch (error) {
      console.warn("Redisç¼“å­˜æ¸…ç©ºå¤±è´¥:", error);
    }
  }

  // åŒæ­¥åˆ°Redis
  async syncToRedis(key, value, expire) {
    const response = await uni.request({
      url: "/api/cache/set",
      method: "POST",
      data: {
        key,
        value,
        expire: Math.floor(expire / 1000), // è½¬æ¢ä¸ºç§’
      },
    });

    return response.data.code === 200;
  }

  // ä»Redisè·å–
  async getFromRedis(key) {
    const response = await uni.request({
      url: "/api/cache/get",
      method: "GET",
      data: { key },
    });

    if (response.data.code === 200) {
      return response.data.data;
    }
    return null;
  }

  // ä»Redisåˆ é™¤
  async deleteFromRedis(key) {
    const response = await uni.request({
      url: "/api/cache/delete",
      method: "DELETE",
      data: { key },
    });

    return response.data.code === 200;
  }

  // æ¸…ç©ºRedis
  async clearRedis() {
    const response = await uni.request({
      url: "/api/cache/clear",
      method: "DELETE",
    });

    return response.data.code === 200;
  }

  // æ‰¹é‡è·å–
  async mget(keys) {
    const results = {};
    const missingKeys = [];

    // å…ˆä»æœ¬åœ°ç¼“å­˜è·å–
    for (const key of keys) {
      const value = await this.get(key, false);
      if (value !== null) {
        results[key] = value;
      } else {
        missingKeys.push(key);
      }
    }

    // æ‰¹é‡ä»Redisè·å–æœªå‘½ä¸­çš„é”®
    if (missingKeys.length > 0) {
      try {
        const response = await uni.request({
          url: "/api/cache/mget",
          method: "POST",
          data: { keys: missingKeys },
        });

        if (response.data.code === 200) {
          const redisResults = response.data.data;
          for (const [key, value] of Object.entries(redisResults)) {
            if (value !== null) {
              results[key] = value;
              // æ›´æ–°æœ¬åœ°ç¼“å­˜
              this.localCache.set(key, value);
              this.expireTime.set(key, Date.now() + 300000);
            }
          }
        }
      } catch (error) {
        console.warn("Redisæ‰¹é‡è·å–å¤±è´¥:", error);
      }
    }

    return results;
  }

  // è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
  getStats() {
    return {
      localCacheSize: this.localCache.size,
      persistentCacheSize: this.persistentKeys.size,
      expiredKeys: Array.from(this.expireTime.entries())
        .filter(([key, time]) => time < Date.now())
        .map(([key]) => key),
    };
  }
}

export const cacheManager = new CacheManager();

// ç¼“å­˜è£…é¥°å™¨
export function cached(options = {}) {
  return function (target, propertyKey, descriptor) {
    const originalMethod = descriptor.value;

    descriptor.value = async function (...args) {
      const cacheKey = `${
        target.constructor.name
      }_${propertyKey}_${JSON.stringify(args)}`;

      // å°è¯•ä»ç¼“å­˜è·å–
      const cachedResult = await cacheManager.get(cacheKey);
      if (cachedResult !== null) {
        return cachedResult;
      }

      // æ‰§è¡ŒåŸæ–¹æ³•
      const result = await originalMethod.apply(this, args);

      // ç¼“å­˜ç»“æœ
      await cacheManager.set(cacheKey, result, options);

      return result;
    };

    return descriptor;
  };
}
```

#### 7.3.2 API è¯·æ±‚ç¼“å­˜

```javascript
// utils/requestCache.js
import { cacheManager } from "./cache";

class RequestCache {
  constructor() {
    this.pendingRequests = new Map(); // é˜²æ­¢é‡å¤è¯·æ±‚
  }

  // ç”Ÿæˆè¯·æ±‚ç¼“å­˜é”®
  generateKey(url, method, data) {
    const key = `api_${method}_${url}_${JSON.stringify(data || {})}`;
    return key.replace(/[^a-zA-Z0-9_]/g, "_");
  }

  // ç¼“å­˜è¯·æ±‚
  async cacheRequest(url, method, data, options = {}) {
    const {
      expire = 300000, // 5åˆ†é’Ÿ
      persistent = false,
      redis = true,
      forceRefresh = false,
    } = options;

    const cacheKey = this.generateKey(url, method, data);

    // å¦‚æœä¸å¼ºåˆ¶åˆ·æ–°ï¼Œå…ˆå°è¯•ä»ç¼“å­˜è·å–
    if (!forceRefresh) {
      const cached = await cacheManager.get(cacheKey);
      if (cached !== null) {
        return cached;
      }
    }

    // é˜²æ­¢é‡å¤è¯·æ±‚
    if (this.pendingRequests.has(cacheKey)) {
      return this.pendingRequests.get(cacheKey);
    }

    // å‘èµ·è¯·æ±‚
    const requestPromise = uni
      .request({
        url,
        method,
        data,
      })
      .then((response) => {
        if (response.data.code === 200) {
          // ç¼“å­˜æˆåŠŸç»“æœ
          cacheManager.set(cacheKey, response.data.data, {
            expire,
            persistent,
            redis,
          });
          return response.data.data;
        } else {
          throw new Error(response.data.message || "è¯·æ±‚å¤±è´¥");
        }
      })
      .finally(() => {
        // æ¸…é™¤å¾…å¤„ç†è¯·æ±‚
        this.pendingRequests.delete(cacheKey);
      });

    this.pendingRequests.set(cacheKey, requestPromise);
    return requestPromise;
  }

  // æ¸…é™¤æŒ‡å®šAPIçš„ç¼“å­˜
  async clearApiCache(pattern) {
    // è¿™é‡Œéœ€è¦åç«¯é…åˆå®ç°æ¨¡å¼åŒ¹é…åˆ é™¤
    try {
      await uni.request({
        url: "/api/cache/clear-pattern",
        method: "DELETE",
        data: { pattern: `api_*${pattern}*` },
      });
    } catch (error) {
      console.warn("æ¸…é™¤APIç¼“å­˜å¤±è´¥:", error);
    }
  }
}

export const requestCache = new RequestCache();

// è¯·æ±‚ç¼“å­˜æ‹¦æˆªå™¨
export const cacheInterceptor = {
  // è¯·æ±‚æ‹¦æˆª
  request(config) {
    // ä¸ºGETè¯·æ±‚æ·»åŠ ç¼“å­˜æ ‡è¯†
    if (config.method === "GET" && !config.noCache) {
      config.useCache = true;
      config.cacheOptions = config.cacheOptions || {};
    }
    return config;
  },

  // å“åº”æ‹¦æˆª
  async response(response, config) {
    // å¦‚æœä½¿ç”¨ç¼“å­˜ä¸”è¯·æ±‚æˆåŠŸ
    if (config.useCache && response.data.code === 200) {
      const cacheKey = requestCache.generateKey(
        config.url,
        config.method,
        config.data
      );

      await cacheManager.set(cacheKey, response.data.data, config.cacheOptions);
    }

    return response;
  },
};
```

#### 7.3.3 ç»„åˆå¼å‡½æ•°ç¼“å­˜

```javascript
// composables/useCache.js
import { ref, computed } from "vue";
import { cacheManager } from "@/utils/cache";

export function useCache() {
  const loading = ref(false);
  const stats = ref({});

  // è·å–ç¼“å­˜
  const getCache = async (key, fetchFromRedis = true) => {
    loading.value = true;
    try {
      return await cacheManager.get(key, fetchFromRedis);
    } finally {
      loading.value = false;
    }
  };

  // è®¾ç½®ç¼“å­˜
  const setCache = async (key, value, options = {}) => {
    loading.value = true;
    try {
      await cacheManager.set(key, value, options);
    } finally {
      loading.value = false;
    }
  };

  // åˆ é™¤ç¼“å­˜
  const deleteCache = async (key) => {
    loading.value = true;
    try {
      await cacheManager.delete(key);
    } finally {
      loading.value = false;
    }
  };

  // æ¸…ç©ºç¼“å­˜
  const clearCache = async () => {
    loading.value = true;
    try {
      await cacheManager.clear();
    } finally {
      loading.value = false;
    }
  };

  // æ‰¹é‡è·å–
  const batchGet = async (keys) => {
    loading.value = true;
    try {
      return await cacheManager.mget(keys);
    } finally {
      loading.value = false;
    }
  };

  // è·å–ç»Ÿè®¡ä¿¡æ¯
  const getStats = () => {
    stats.value = cacheManager.getStats();
    return stats.value;
  };

  // ç¼“å­˜å‘½ä¸­ç‡ï¼ˆè®¡ç®—å±æ€§ï¼‰
  const hitRate = computed(() => {
    if (!stats.value.localCacheSize) return 0;
    const expiredCount = stats.value.expiredKeys?.length || 0;
    return (
      ((stats.value.localCacheSize - expiredCount) /
        stats.value.localCacheSize) *
      100
    ).toFixed(2);
  });

  return {
    loading: readonly(loading),
    stats: readonly(stats),
    hitRate,
    getCache,
    setCache,
    deleteCache,
    clearCache,
    batchGet,
    getStats,
  };
}

// ç”¨äºæ•°æ®åˆ—è¡¨ç¼“å­˜çš„ç»„åˆå¼å‡½æ•°
export function useListCache(listKey, fetchFunction, options = {}) {
  const loading = ref(false);
  const list = ref([]);
  const total = ref(0);
  const page = ref(1);
  const pageSize = ref(options.pageSize || 20);

  const {
    expire = 300000, // 5åˆ†é’Ÿ
    persistent = false,
    redis = true,
  } = options;

  // ç”Ÿæˆç¼“å­˜é”®
  const getCacheKey = (pageNum, size) => {
    return `${listKey}_page_${pageNum}_size_${size}`;
  };

  // åŠ è½½æ•°æ®
  const loadData = async (pageNum = 1, refresh = false) => {
    loading.value = true;
    const cacheKey = getCacheKey(pageNum, pageSize.value);

    try {
      // å¦‚æœä¸æ˜¯åˆ·æ–°ï¼Œå…ˆå°è¯•ä»ç¼“å­˜è·å–
      if (!refresh) {
        const cached = await cacheManager.get(cacheKey);
        if (cached) {
          list.value =
            pageNum === 1 ? cached.list : [...list.value, ...cached.list];
          total.value = cached.total;
          page.value = pageNum;
          loading.value = false;
          return cached;
        }
      }

      // ä»APIè·å–æ•°æ®
      const result = await fetchFunction({
        page: pageNum,
        pageSize: pageSize.value,
      });

      // ç¼“å­˜æ•°æ®
      await cacheManager.set(cacheKey, result, {
        expire,
        persistent,
        redis,
      });

      // æ›´æ–°çŠ¶æ€
      list.value =
        pageNum === 1 ? result.list : [...list.value, ...result.list];
      total.value = result.total;
      page.value = pageNum;

      return result;
    } finally {
      loading.value = false;
    }
  };

  // åˆ·æ–°æ•°æ®
  const refresh = () => {
    return loadData(1, true);
  };

  // åŠ è½½æ›´å¤š
  const loadMore = () => {
    if (list.value.length >= total.value) return;
    return loadData(page.value + 1);
  };

  // æ¸…é™¤åˆ—è¡¨ç¼“å­˜
  const clearListCache = async () => {
    // æ¸…é™¤æ‰€æœ‰ç›¸å…³é¡µé¢çš„ç¼“å­˜
    for (let i = 1; i <= page.value; i++) {
      const cacheKey = getCacheKey(i, pageSize.value);
      await cacheManager.delete(cacheKey);
    }
  };

  // æ˜¯å¦è¿˜æœ‰æ›´å¤šæ•°æ®
  const hasMore = computed(() => {
    return list.value.length < total.value;
  });

  return {
    loading: readonly(loading),
    list: readonly(list),
    total: readonly(total),
    page: readonly(page),
    pageSize: readonly(pageSize),
    hasMore,
    loadData,
    refresh,
    loadMore,
    clearListCache,
  };
}
```

## å…«ã€æµ‹è¯•è§„èŒƒ

### 8.1 å•å…ƒæµ‹è¯•

**å®‰è£…æµ‹è¯•ä¾èµ–ï¼š**

```bash
npm install --save-dev @vue/test-utils vitest
```

**æµ‹è¯•ç¤ºä¾‹ï¼š**

```javascript
// tests/components/CustomButton.test.js
import { mount } from "@vue/test-utils";
import { describe, it, expect } from "vitest";
import CustomButton from "@/components/common/CustomButton.vue";

describe("CustomButton", () => {
  it("renders with correct text", () => {
    const wrapper = mount(CustomButton, {
      props: {
        text: "Click me",
      },
    });

    expect(wrapper.text()).toBe("Click me");
  });

  it("emits click event when clicked", async () => {
    const wrapper = mount(CustomButton);

    await wrapper.trigger("click");

    expect(wrapper.emitted()).toHaveProperty("click");
  });
});
```

### 8.2 é›†æˆæµ‹è¯•

```javascript
// tests/integration/user-login.test.js
import { mount } from "@vue/test-utils";
import { describe, it, expect, beforeEach } from "vitest";
import LoginPage from "@/pages/user/login.vue";

describe("ç”¨æˆ·ç™»å½•æµç¨‹", () => {
  let wrapper;

  beforeEach(() => {
    wrapper = mount(LoginPage);
  });

  it("should show validation error for invalid phone", async () => {
    const phoneInput = wrapper.find('[data-test="phone-input"]');
    await phoneInput.setValue("123");

    const submitButton = wrapper.find('[data-test="submit-button"]');
    await submitButton.trigger("click");

    expect(wrapper.find('[data-test="phone-error"]').text()).toBe(
      "è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·"
    );
  });
});
```

## ä¹ã€éƒ¨ç½²ä¸å‘å¸ƒ

### 9.1 ç¯å¢ƒé…ç½®

**.env.developmentï¼š**

```bash
# å¼€å‘ç¯å¢ƒ
NODE_ENV=development
VUE_APP_API_BASE_URL=http://localhost:3000/api
VUE_APP_MOCK=true
VUE_APP_TITLE=çˆ±ä¸Šæœç¾äºº(å¼€å‘ç‰ˆ)
```

**.env.productionï¼š**

```bash
# ç”Ÿäº§ç¯å¢ƒ
NODE_ENV=production
VUE_APP_API_BASE_URL=https://api.example.com
VUE_APP_MOCK=false
VUE_APP_TITLE=çˆ±ä¸Šæœç¾äºº
```

### 9.2 æ„å»ºè„šæœ¬

**package.jsonï¼š**

```json
{
  "scripts": {
    "dev:h5": "uni -p h5",
    "dev:mp-weixin": "uni -p mp-weixin",
    "dev:app": "uni -p app",
    "build:h5": "uni build -p h5",
    "build:mp-weixin": "uni build -p mp-weixin",
    "build:app": "uni build -p app",
    "lint": "eslint src --ext .vue,.js,.ts",
    "lint:fix": "eslint src --ext .vue,.js,.ts --fix",
    "test": "vitest",
    "test:coverage": "vitest --coverage"
  }
}
```

### 9.3 CI/CD é…ç½®

**.github/workflows/deploy.ymlï¼š**

```yaml
name: Deploy

on:
  push:
    branches: [main]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18"

      - name: Install dependencies
        run: npm ci

      - name: Run tests
        run: npm run test

      - name: Build for H5
        run: npm run build:h5

      - name: Deploy to server
        # éƒ¨ç½²åˆ°æœåŠ¡å™¨çš„æ­¥éª¤
        run: echo "Deploy to server"
```

## åã€é¡¹ç›®ç»´æŠ¤

### 10.1 ä»£ç å®¡æŸ¥

**å®¡æŸ¥æ¸…å•ï¼š**

- [ ] ä»£ç ç¬¦åˆå›¢é˜Ÿè§„èŒƒ
- [ ] åŠŸèƒ½å®ç°æ­£ç¡®
- [ ] æ€§èƒ½è€ƒè™‘å……åˆ†
- [ ] å®‰å…¨æ€§æ£€æŸ¥
- [ ] æµ‹è¯•è¦†ç›–å……åˆ†
- [ ] æ–‡æ¡£æ›´æ–°å®Œæ•´

### 10.2 ç›‘æ§ä¸æ—¥å¿—

```javascript
// utils/monitor.js
class Monitor {
  constructor() {
    this.errors = [];
    this.performance = [];
  }

  // é”™è¯¯ç›‘æ§
  captureError(error, context = {}) {
    const errorInfo = {
      message: error.message,
      stack: error.stack,
      context,
      timestamp: new Date().toISOString(),
      userAgent: navigator.userAgent,
      url: location.href,
    };

    this.errors.push(errorInfo);

    // å‘é€åˆ°é”™è¯¯æ”¶é›†æœåŠ¡
    this.sendToErrorService(errorInfo);
  }

  // æ€§èƒ½ç›‘æ§
  capturePerformance(metric, value) {
    const performanceInfo = {
      metric,
      value,
      timestamp: new Date().toISOString(),
    };

    this.performance.push(performanceInfo);
  }

  sendToErrorService(errorInfo) {
    // å‘é€é”™è¯¯ä¿¡æ¯åˆ°ç›‘æ§æœåŠ¡
    if (process.env.NODE_ENV === "production") {
      // å®é™…çš„é”™è¯¯æ”¶é›†æœåŠ¡è°ƒç”¨
    }
  }
}

export const monitor = new Monitor();

// å…¨å±€é”™è¯¯å¤„ç†
window.addEventListener("error", (event) => {
  monitor.captureError(event.error);
});

window.addEventListener("unhandledrejection", (event) => {
  monitor.captureError(new Error(event.reason));
});
```

## åä¸€ã€ä¼˜åŒ–æ›´æ–°å†…å®¹

### 11.1 å¾®ä¿¡ç”Ÿæ€æ·±åº¦é›†æˆ

æ ¹æ®é¡¹ç›®ä¸»è¦è¿è¡Œåœ¨å¾®ä¿¡ç¯å¢ƒçš„éœ€æ±‚ï¼ŒæŠ€æœ¯è§„èŒƒå·²é’ˆå¯¹æ€§ä¼˜åŒ–ï¼š

1. **H5 ç«¯å¾®ä¿¡é€‚é…**

   - å¾®ä¿¡æµè§ˆå™¨ç¯å¢ƒæ£€æµ‹
   - å¾®ä¿¡ JS-SDK é›†æˆ
   - å¾®ä¿¡æˆæƒç™»å½•
   - å¾®ä¿¡åˆ†äº«åŠŸèƒ½

2. **å°ç¨‹åºç«¯ä¼˜åŒ–**
   - å°ç¨‹åºé¡¹ç›®é…ç½®
   - å¾®ä¿¡æˆæƒç™»å½•
   - æ‰‹æœºå·å¿«é€ŸéªŒè¯

### 11.2 å¤šå…ƒåŒ–ç”¨æˆ·è®¤è¯

å®Œå–„çš„ç”¨æˆ·æ³¨å†Œè®¤è¯ä½“ç³»ï¼š

1. **æ‰‹æœºå·+éªŒè¯ç ç™»å½•**

   - çŸ­ä¿¡éªŒè¯ç å‘é€
   - éªŒè¯ç éªŒè¯ç™»å½•
   - é˜²åˆ·æœºåˆ¶

2. **å°ç¨‹åºå¿«é€ŸéªŒè¯**

   - å¾®ä¿¡å°ç¨‹åºæ‰‹æœºå·ç»„ä»¶
   - ä¸€é”®è·å–æ‰‹æœºå·
   - å¿«é€Ÿæ³¨å†Œç™»å½•

3. **å¾®ä¿¡æˆæƒç™»å½•**
   - H5 ç«¯å¾®ä¿¡ç½‘é¡µæˆæƒ
   - å°ç¨‹åºç«¯æˆæƒç™»å½•
   - ç”¨æˆ·ä¿¡æ¯è·å–

### 11.3 é˜¿é‡Œäº‘ OSS å›¾ç‰‡æœåŠ¡

é›†æˆé˜¿é‡Œäº‘ OSS å®Œæ•´è§£å†³æ–¹æ¡ˆï¼š

1. **å®‰å…¨ä¸Šä¼ **

   - STS ä¸´æ—¶å‡­è¯
   - ç­¾åéªŒè¯
   - æ–‡ä»¶ç±»å‹æ£€æŸ¥

2. **é«˜æ•ˆç®¡ç†**

   - æ‰¹é‡ä¸Šä¼ 
   - è¿›åº¦æ˜¾ç¤º
   - åˆ é™¤ç®¡ç†

3. **ç»„ä»¶åŒ–**
   - å›¾ç‰‡ä¸Šä¼ ç»„ä»¶
   - é¢„è§ˆåŠŸèƒ½
   - å‹ç¼©å¤„ç†

### 11.4 Redis ç¼“å­˜ä½“ç³»

å»ºç«‹å®Œå–„çš„ç¼“å­˜æœºåˆ¶ï¼š

1. **å¤šå±‚çº§ç¼“å­˜**

   - å†…å­˜ç¼“å­˜ï¼ˆæœ€å¿«ï¼‰
   - æœ¬åœ°å­˜å‚¨ç¼“å­˜
   - Redis ç¼“å­˜ï¼ˆå…±äº«ï¼‰

2. **æ™ºèƒ½ç®¡ç†**

   - è¿‡æœŸæœºåˆ¶
   - æ‰¹é‡æ“ä½œ
   - ç»Ÿè®¡åˆ†æ

3. **æ€§èƒ½ä¼˜åŒ–**
   - è¯·æ±‚ç¼“å­˜
   - åˆ—è¡¨ç¼“å­˜
   - é˜²é‡å¤è¯·æ±‚

### 11.5 éƒ¨ç½²é…ç½®ä¼˜åŒ–

é‡ç‚¹å…³æ³¨ H5 å’Œå°ç¨‹åºéƒ¨ç½²ï¼š

1. **æ„å»ºä¼˜åŒ–**

   - é’ˆå¯¹å¾®ä¿¡ç¯å¢ƒä¼˜åŒ–
   - èµ„æºå‹ç¼©
   - ä»£ç åˆ†å‰²

2. **ç¯å¢ƒé…ç½®**
   - å¼€å‘ç¯å¢ƒé…ç½®
   - ç”Ÿäº§ç¯å¢ƒé…ç½®
   - å¾®ä¿¡ç›¸å…³é…ç½®

æ­¤æŠ€æœ¯è§„èŒƒæ–‡æ¡£ä¸ºç”¨æˆ·ç«¯å‰ç«¯å¼€å‘æä¾›äº†å®Œæ•´çš„æŠ€æœ¯æŒ‡å¯¼ï¼Œç‰¹åˆ«é’ˆå¯¹å¾®ä¿¡ç”Ÿæ€ã€ç”¨æˆ·è®¤è¯ã€ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆå’Œç¼“å­˜ä¼˜åŒ–è¿›è¡Œäº†æ·±åº¦å®šåˆ¶ï¼Œç¡®ä¿å¼€å‘å›¢é˜Ÿèƒ½å¤Ÿé«˜æ•ˆåœ°æ„å»ºé«˜è´¨é‡çš„å¾®ä¿¡ç”Ÿæ€å¤šç«¯åº”ç”¨ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šV2.0  
**æ›´æ–°æ—¥æœŸ**ï¼š2025 å¹´ 09 æœˆ 27 æ—¥  
**æ›´æ–°å†…å®¹**ï¼šå¾®ä¿¡ç”Ÿæ€é›†æˆã€å¤šå…ƒåŒ–è®¤è¯ã€OSS æœåŠ¡ã€Redis ç¼“å­˜  
**æ–‡æ¡£çŠ¶æ€**ï¼šå·²ä¼˜åŒ–å®Œæˆ  
**å®¡æ ¸çŠ¶æ€**ï¼šå¾…å®¡æ ¸
